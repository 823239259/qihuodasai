<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <script src="js/common.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/own.css"/>
    <script>  
    	mui.init();
    	//Android双击home键退出应用
    	var first = null;
    	//当前应用版本号
	  	var wgtVer=null;
		mui.plusReady(function(){
			
			// 获取本地应用资源版本号
			plus.runtime.getProperty(plus.runtime.appid,function(inf){
				wgtVer=inf.version;
			});
			
			//检查更新版本
			checkUpdate(function(){
				if (mui.cacheUser.isLogin()){
					mui.openWindow("home.html");
				}
			});
			
    		document.getElementById("regist").addEventListener("tap",function(){
				mui.openWindow("tzdr/login/regist.html");
			});
			document.getElementById("visit").addEventListener("tap",function(){
				mui.openWindow("home.html");
			});
			document.getElementById("login").addEventListener("tap",function(){
				mui.openWindow("tzdr/login/login.html","login");
			});
			
			//状态栏设置
			setstatus();
			
			if (mui.os.stream) {
			    //创建桌面快捷方式
			    if (mui.isFunction(plus.navigator.createShortcut)) {
			        plus.navigator.createShortcut({
			            name: "投资达人",
			            icon: "images/icons/icon180x180.png"
			        }); //注意换成自己的名字和图标
			    }
			}
			
			//Android双击home键退出应用
			mui.back = function(){
               if(!first) {
					first = new Date().getTime(); 
					mui.toast('再按一次退出投资达人');
					setTimeout(function() {
					first = null;
					}, 1000);
				}else{
					if (new Date().getTime() - first < 1000) {   
						plus.runtime.quit();  
					} 
				}
        	};
		});
		
		//状态栏设置
		function setstatus(){
			if(plus.navigator.isFullscreen()){
				plus.navigator.setFullscreen(false);
			}
		};
		
		// 检测更新
		function checkUpdate(_callback){
			//获取网银充值账户余额信息
			mui.app_request('/getVersion',{force:true},
				function(result){
					var newVer = result.data.version;
					if(mui.isnull(newVer)||!(wgtVer&&newVer&&(wgtVer!=newVer))){
						_callback();
					}else{
						//弹出版本升级提示信息对话框
						plus.nativeUI.confirm( "检测到有新版本需要升级，是否升级到最新版本?", function(e){
							if(e.index==0){
								downWgt(_callback);	// 下载升级包
							}else{
								_callback();
							}
						}, "软件升级", ["升级","稍后再说"] );
					}
				},function(result){
					_callback();
					return; 
				}
    		);
		}
		
		// 下载wgt文件
		function downWgt(_callback){
			plus.nativeUI.showWaiting("下载升级包...");
			plus.downloader.createDownload(tzdr.constants.api_domain +"upload/H50967E1D.wgt", {filename:"_doc/update/"}, function(d,status){
				plus.nativeUI.closeWaiting();
				if (status == 200) { 
					installWgt(d.filename,_callback);	// 安装wgt包
				}else{
					// 弹出系统提示对话框
					plus.nativeUI.alert( "下载升级包失败！", function(){
						_callback();
					}, "软件升级", "确定" );
				}
			}).start();
		}
		
		// 更新应用资源
		function installWgt(path,_callback){
			plus.nativeUI.showWaiting("软件升级..."); 
			plus.runtime.install(path,{force:true},function(){
				plus.nativeUI.closeWaiting();
				plus.runtime.restart();
			},function(e){
				plus.nativeUI.closeWaiting();
				// 弹出系统提示对话框
				plus.nativeUI.alert( "应用升级失败！", function(){
					_callback();
				}, "软件升级", "确定" );
			});
		}
    </script>
</head>
<body>
<div class="mui-content main_page">
	<img src="images/main.png" />
	<div class="main_link">
		<a href="javascript:void(0);" id="login" class="main_login">登录</a>
		<a href="javascript:void(0);" id="regist" class="main_regist">注册</a>
		<a href="javascript:void(0);" id="visit" class="main_other">先随便逛逛 ></a>
	</div>
	<p>Copyright © 2016 上海信闳投资管理有限公司 版权所有</p>
</div>
</body>
</html>