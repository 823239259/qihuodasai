<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>新用户注册</title>
    <link rel="stylesheet" href="../../css/mui.min.css" />
    <link rel="stylesheet" href="../../css/own.css" />
    <script type="text/javascript" src="../../js/mui.min.js"></script>   
    <script type="text/javascript" src="../../js/common.js"></script>
    <script src="../../js/jquery-1.11.3.js"></script>
    <style>
    	 body{
    	background-image: url("../../images/login.png");
    	background-size: cover;
   	 }
		.mui-bar{
		background-color: rgba(0,0,0,0);
		color:#FFFFFF;
	}
	#back{
		color:#FFFFFF;
	}
	.mui-title{
		color:#FFFFFF!important;
	}
	#nav-title, .top-tel{
		color:#FFFFFF
	}
	.mui-bar-nav{
		-webkit-box-shadow:none;
		box-shadow:none;
	}
	.commStyle label{
	 	color:#ffffff;
	 }
	 .commStyle input{
	 	text-align: left;
	 	color:#cccccc;
	 	background-color: rgba(0,0,0,0);
		border:none;
	 }
	 .commStyle .mui-btn-block{
		 	padding:0px 0px 0px 0px;
		 	margin-bottom: 0px;
		 	border:none
		 }
	.commStyle span,a{
		 	display: inline-block;
		 	color:#FFFFFF
		 }
		 #operateLogin{
		background-color: #cccccc;
	}
	.mui-content-padded{
		margin: 0px;;
	}
	.mui-input-group, .mui-content-padded{
		margin: 0px;
	}
    </style>
    <script>
    	mui.init();
    	mui.plusReady(function(){
    		loadCss();
			function loadCss(){
					var Proportion=1;
					var resolutionWidth=plus.screen.resolutionWidth;
					Proportion=resolutionWidth/320;
					console.log(Proportion);
					$("#logo").css({
						"padding-top":Proportion*40+"px"
					})
					$("#logo img").css({
						"width":Proportion*60+"px",
						"height":"auto",
						"display":"block",
						"margin":"auto"
					})
					$("#inputList").css({
						"width": "100%",
						"padding":Proportion*40+"px "+Proportion*20+"px",
					
					});
					$(".commStyle").css({
						"width": "100%",
						"height": Proportion*40+"px",
						"line-height":Proportion*40+"px",
						"margin-top": Proportion*10+"px",
						"color":"#ffffff",
						"font-size": Proportion*14+"px",
						"position": "relative",
						"border-bottom":"1px solid #999999"
					});
					$(".commStyle label").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"font-size": Proportion*14+"px"
					});
					$(".commStyle span").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"font-size": Proportion*14+"px",
//					 	"width":"100%",
					});
					$("#forgetPasswordDiv").css({
						"width":"100%",
						"text-align":"right"
					})
					$("#resigterDiv").css({
						"width":"100%",
						"text-align":"center",
						"border-bottom":"none"
					})
					$(".commStyle a").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"font-size": Proportion*14+"px",
					});
					$(".commStyle input").css({
						"height": Proportion*39+"px",
 						"line-height": Proportion*39+"px",
 						"width": 200*Proportion+"px",
					 	"padding-left": Proportion*10+"px",
					 	"font-size": Proportion*12+"px",
					 	"position": "relative",
					 	"top":Proportion*-1.1+"px"
					});
					$(" .commStyle select").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"width": 199*Proportion+"px",
					 	"font-size": Proportion*12+"px",
					});
					$(".commStyle img").css({
						"position": "absolute",
					  	"width": Proportion*15+"px",
					  	"right": "2px",
					  	"top":Proportion*16+"px",
					});
					$("#operateLogin").css({
						"height":Proportion*40+"px",
					 	"line-height": Proportion*40+"px",
					 	"font-size": Proportion*16+"px",
					 	"padding":"0px",
					 	"color":"#2b2b2b",
					 	"border":"none"
					 	
					});
					$("#forgetPasswordDiv").css({
						"border-bottom":"none"
					})
				}
    		//获取友盟的统计代码
    		/*var channel;
    		if(plus.os.name=="iOS"){
    			mui.getJSON("../../manifest.json",null,function(data){
    				channel=data.plus.distribute.plugins.statics.umeng.appkey_ios;
    			});
    		}else if(plus.os.name=="Android"){
    			mui.getJSON("../../manifest.json",null,function(data){
    				channel=data.plus.distribute.plugins.statics.umeng.appkey_android;
    			});
    		}else{
    			mui.getJSON("../../manifest.json",null,function(data){
    				channel=data.plus.distribute.plugins.statics.umeng.appkey_android;
    			});
    		}*/
    		//清除遗留数据
    		clearinfo();
    		document.getElementById("back").addEventListener("tap",function(){
    			history.back();
    		});
    		document.getElementById("telBtn").addEventListener("tap",function(){
    			mui.callService();
    		});
    		document.getElementById("code").addEventListener("tap",function(){
    			
    			getCode();
    		});
    		document.getElementById("reg").addEventListener("tap",function(){
    			registUser();
    		});
    		
    		document.getElementById("tzdr_info").addEventListener("tap",function(){
    			mui.openWindow("../agree/tzdr.html");
    		});
   
    	
    	
    	function clearinfo(){
    		document.getElementById("account").value="";
			document.getElementById("password").value="";
			document.getElementById("password_confirm").value="";
			document.getElementById("email").value="";//确认密码
    	};
    	
    	//获取验证码
    	function getCode(){
    		var mobile=document.getElementById("account").value;
    		//这里要对手机号码进行格式校验
    		if(!tzdr.validate_mobile(mobile)||mui.isnull(mobile)){
    			mui.toast("手机号码不正确");
    			return;
    		}   
    		var paramUrl={
				url:"login.html"
			}
    		mui.app_request('sms',{ 
      			 'mobile':mobile,
			     'type':1  
      		},function(result){
      				mui.toast("发送成功！");  
      				var o=document.getElementById("code");
		  			tzdr.smsTime(o); 
      				return;
      			
      		},function(result){
      			if(result.code==2){
      				mui.toast("短信验证码发送失败！");
      				return;
      			}else if(result.code==5){
      				mui.toast("操作过于频繁，请稍后再试！");
      				return;
      			}else if(result.code==3){
      				mui.toast("手机号码已经存在！");
      				return;
      			}else{
      				mui.toast("系统繁忙，请稍后再试！");
      				return;
      			}
      			
      		},paramUrl);
    	}  
    	function registUser(){
    		var mobile=document.getElementById("account").value;
			var code=document.getElementById("password").value;
			var password=document.getElementById("password_confirm").value;
			var password2=document.getElementById("email").value;//确认密码
			//这里要对手机号码进行格式校验
			var channel=null;
			if(plus.storage.getItem("apk") != null){
				channel=plus.storage.getItem("apk");
			}else{
				channel="57b2d65067e58e601d00258a";
			}
    		if(!tzdr.validate_mobile(mobile)||mui.isnull(mobile)){
    			mui.toast("手机号码不正确");
    			return;
    		}
			if(mui.isnull(code)){
				mui.toast("验证码不能为空！");
				return;
			}

			if(mui.isnull(password)){
				mui.toast("登录密码不能为空！");
				return;
			}
			if(mui.isnull(password2)){
				mui.toast("确认密码不能为空！");
				return;
			}
			
			if(!tzdr.validate_password(password)){
				mui.toast("密码由6-16位数字和字母组成。");
				return;
			}
			//校验登录密码与确认密码是否一致
			if(password!=password2){
				mui.toast("两次输入的密码不一致！");
				return;
			}
			var paramUrl={
				url:"login.html"
			}
			mui.app_request('/regist',{ 
      			 'mobile':mobile,
			    'code':code,
			    'password':password,
			    "channel":channel
      	},function(result){
      				mui.toast("恭喜您注册成功！");
      				//存储用户信息
      				mui.cacheUser.save(result.data.token,result.data.secret,mobile);
      				mui.openWindow("../quotation/quotationMain.html");
      				return;
      			
      		},function(result){
      			if(result.code==2){
      				mui.toast("注册失败！");
      				return;
      			}else if(result.code==7){
      				mui.toast("密码格式有误！");
      				return;
      			}else if(result.code==3){
      				mui.toast("手机号码已经存在！");
      				return;
      			}else if(result.code==4){
      				mui.toast("验证码错误或为空！");
      				return;
      			}else if(result.code==5){
      				mui.toast("验证码失效！");
      				return;
      			}else if(result.code==6){
      				mui.toast("推广码错误！");
      				return;
      			}else{
      				mui.toast("系统繁忙，请稍后再试！");
      				return;
      			}
      		
      		},paramUrl);
			
			
    	};
 	});
    </script>
</head>
<body style="background-color: #2B2B2B">	
	<header class="mui-bar mui-bar-nav own-topbg">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" id="back"><i>返回</i></a>
		<h1 class="mui-title">新用户注册</h1>		
		<a href="javascript:void(0)" class="top-tel" id="telBtn">客服热线</a>
	</header>
	<div class="mui-content">
		<div id="logo">
			<img src="../../images/LOGO.png" >
		</div>
		<div id="inputList">
			<div class="commStyle">
				<label>手机：</label>
				<input type="text"  placeholder="请输入您的账号" id='account'/>
				<img src="../../images/close.png" id="accountClear">
			</div>
			<div class="commStyle">
				<label>登录密码：</label>
				<input type="password"  placeholder="请输入您的密码" id="password"/>
				<img src="../../images/close.png" id="passwordClear">
			</div>
			<div class="commStyle"  id="forgetPasswordDiv">
				<span id="forgetPassword">忘记密码</span>
			</div>
			<div class="mui-content-padded">
				<button  class="mui-btn mui-btn-block" id="operateLogin">下一步</button>
				<!--<button id='regLogin' class="mui-btn mui-btn-block">开通外盘期货账户</button>-->
			</div>
			<div class="commStyle"  id="resigterDiv">
				<a id='reg' href="javascript:void(0)">注册账号</a>
			</div>
		</div>
		<form class="mui-input-group">
			<div class="mui-input-row">
				<!--<label>手机号码</label>
				<input id='account' type="tel" class="mui-input-clear mui-input" placeholder="请输入手机号码" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')">
			</div>
			<div class="mui-input-row">
				<!--<label>短信验证</label>-->
				<input id='password' type="number" class="mui-input" placeholder="请输入验证码" maxlength="6">
				<button class="lg_codebtn" id="code" type="button">发送验证码</button>
			</div>
			<div class="mui-input-row">
				<!--<label>登录密码</label>-->
				<input id='password_confirm' type="password" class="mui-input-clear mui-input" placeholder="6-16位数字和字母组成" onkeyup="value=value.replace(/[\W]/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" >
			</div>
			<div class="mui-input-row">
				<!--<label>确认密码</label>-->
				<input id='email' type="password" class="mui-input-clear mui-input" placeholder="请再次输入密码" onkeyup="value=value.replace(/[\W]/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" >
			</div>
		</form>-->
		<div class="mui-content-padded">
			<button id='reg' class="mui-btn mui-btn-block lg-btnlogin">立即注册</button>
		</div>
		<div class="mui-content-padded">
			<p class="RegistrationTips">点击“注册”按钮表示您已阅读并同意<a href="javascript:void(0);" id="tzdr_info" style="color: #FFCC33;">《维胜协议》</a></p>
		</div>
	</div>
</body>
</html>