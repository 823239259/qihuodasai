<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>用户登录</title>    
    <link rel="stylesheet" href="../../css/mui.min.css" />
    <link rel="stylesheet" href="../../css/own.css" />
    <script type="text/javascript" src="../../js/mui.min.js"></script>  
    <script type="text/javascript" src="../../js/common.js"></script>
    <script src="../../js/jquery-1.11.3.js"></script>
    <style>
    body{
    	background-image: url("../../images/resigter.png");
    	background-size: cover;
    }
	.mui-bar{
		background-color: rgba(0,0,0,0);
		color:#FFFFFF;
	}
	#back{
		color:#FFFFFF;
	}
	.mui-title{
		color:#FFFFFF!important;
	}
	#nav-title, .top-tel{
		color:#FFFFFF
	}
	.mui-bar-nav{
		-webkit-box-shadow:none;
		box-shadow:none;
	}
	.commStyle label{
	 	color:#ffffff;
	 }
	 .commStyle input{
	 	text-align: left;
	 	color:#cccccc;
	 	background-color: rgba(0,0,0,0);
		border:none;
	 }
	 .commStyle .mui-btn-block{
		 	padding:0px 0px 0px 0px;
		 	margin-bottom: 0px;
		 	border:none
		 }
	.commStyle span,a{
		 	display: inline-block;
		 	color:#FFFFFF
		 }
		 #operateLogin{
		background-color: #cccccc;
	}
	.mui-content-padded{
		margin: 0px;;
	}
	.mui-input-group, .mui-content-padded{
		margin: 0px;
	}
		</style>
	<script>
	var win= null;
		mui.init();
		
		mui.plusReady(function(){
			loadCss();
			function loadCss(){
					var Proportion=1;
					var resolutionWidth=plus.screen.resolutionWidth;
					Proportion=resolutionWidth/320;
					console.log(Proportion);
					$("#logo").css({
						"padding-top":Proportion*40+"px"
					})
					$("#logo img").css({
						"width":Proportion*60+"px",
						"height":"auto",
						"display":"block",
						"margin":"auto"
					})
					$("#inputList").css({
						"width": "100%",
						"padding":Proportion*40+"px "+Proportion*20+"px",
					
					});
					$(".commStyle").css({
						"width": "100%",
						"height": Proportion*40+"px",
						"line-height":Proportion*40+"px",
						"margin-top": Proportion*10+"px",
						"color":"#ffffff",
						"font-size": Proportion*14+"px",
						"position": "relative",
						"border-bottom":"1px solid #999999"
					});
					$(".commStyle label").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"font-size": Proportion*14+"px"
					});
					$(".commStyle span").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"font-size": Proportion*14+"px",
//					 	"width":"100%",
					});
					$("#forgetPasswordDiv").css({
						"width":"100%",
						"text-align":"right"
					})
					$("#resigterDiv").css({
						"width":"100%",
						"text-align":"center",
						"border-bottom":"none"
					})
					$(".commStyle a").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"font-size": Proportion*14+"px",
					});
					$(".commStyle input").css({
						"height": Proportion*39+"px",
 						"line-height": Proportion*39+"px",
 						"width": 200*Proportion+"px",
					 	"padding-left": Proportion*10+"px",
					 	"font-size": Proportion*14+"px",
					 	"position": "relative",
					 	"top":Proportion*-1.1+"px"
					});
					$(" .commStyle select").css({
						"height": Proportion*39+"px",
					 	"line-height": Proportion*39+"px",
					 	"width": 199*Proportion+"px",
					 	"font-size": Proportion*12+"px",
					});
					$(".commStyle img").css({
						"position": "absolute",
					  	"width": Proportion*15+"px",
					  	"right": "2px",
					  	"top":Proportion*16+"px",
					});
					$("#operateLogin").css({
						"height":Proportion*40+"px",
					 	"line-height": Proportion*40+"px",
					 	"font-size": Proportion*16+"px",
					 	"padding":"0px",
					 	"color":"#2b2b2b",
					 	"border":"none"
					 	
					});
					$("#forgetPasswordDiv").css({
						"border-bottom":"none"
					})
				}
			if (mui.cacheUser.isLogin()){
				mui.openWindow("../quotation/quotationMain.html");
			}
			win=plus.webview.currentWebview();
			 /*绑定事件
				 */
				$("#accountClear").click(function(){
					$("#account").val("");
				});
				$("#passwordClear").click(function(){
					$("#password").val("");
				});
			// 清除缓存页面
			//mui.cacheUser.clearCachePages();
			$(".mui-content").css({
					"opacity":"1"
				})
			//清除遗留数据
			clearinfo();
			document.getElementById("back").addEventListener("tap",function(){
    			history.back();
    		});
    		document.getElementById("telBtn").addEventListener("tap",function(){
    			mui.callService();
    		});
			document.getElementById("reg").addEventListener("tap",function(){
				mui.openWindow("regist.html");
			});
			document.getElementById("forgetPassword").addEventListener("tap",function(){
				mui.openWindow("retrievePassword.html");
			});
			document.getElementById("operateLogin").addEventListener("tap",function(){
				userLogin();
			});
		});
		function clearinfo(){
			document.getElementById("account").value="";
			document.getElementById("password").value="";
		};
//		function MacthValue(){
//			var mobile=document.getElementById("account").value;
//			var mobilePattern={mobile: /^0?(13[0-9]|15[012356789]|18[0236789]|14[57])[0-9]{8}$/ };
//			
//		}
		function userLogin(){
			var mobile=document.getElementById("account").value;
			var password=document.getElementById("password").value;
			//这里要对手机号码进行格式校验
    		if(!tzdr.validate_mobile(mobile)||mui.isnull(mobile)){
    			mui.toast("请输入正确的手机号");
    			return;
    		}
    		if(mui.isnull(password)){
    			mui.toast("请输入正确密码！");
    			return;
    		}
			var paramUrl={
				url:"login.html"
			}
			mui.app_request('/login',{ 
      			 'loginName':mobile,
			    'password':password
      	},function(result){
      				mui.toast("登录成功！"); 
      				//存储用户信息
      				mui.cacheUser.save(result.data.token,result.data.secret,mobile);
      				if (win.backpageID){ 
      					mui.app_back(win.backpageID,true);   //放回businessPageId页面，并且刷新该页面信息
      					return;
      				}
      				var wsreload = plus.webview.getWebviewById("quotationMain");
      				if(wsreload != null){
	      				wsreload.reload(); 
      				}
      				mui.openWindow("../quotation/quotationMain.html","quotationMain");
      				return;
      			
      	},function(result){
      			if(result.code==3){
      				mui.toast("用户名或密码为空！"); 
      				return;
      			}else if(result.code==4){
      				mui.toast("帐号或密码错误！"); 
      				return;
      			}else if(result.code==2){
      				mui.toast("登录失败！"); 
      				return;
      			}else{
      				mui.toast("帐号或密码错误");
      				return;
      			}
      			
      		},paramUrl);
			
		};
		/*按钮变色*/
			function checkValue(){
				var account=$("#account").val();
				var password=$("#password").val();
				if(account.length>0 && password.length>0){
					$("#operateLogin").css({
						"background-color":"#fcc900"
					});
				}else{
					$("#operateLogin").css({
						"background-color":"#cccccc"
					});
				}
			}
	</script>
</head>
<body class="ui-page-login">	
	<header class="mui-bar mui-bar-nav topMenu">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" id="back"></a>
		<h1 class="mui-title">登录</h1>		
		<a href="javascript:void(0)" class="top-tel" id="telBtn">客服热线</a>
	</header>
	<div class="mui-content " style="opacity: 0;">
		<div id="logo">
			<img src="../../images/LOGO.png" >
		</div>
		
		<div id="inputList">
			<div class="commStyle">
				<label>手机：</label>
				<input type="text"  placeholder="请输入您的账号" id='account' oninput="checkValue()" autocomplete="off"  onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')"/>
				<img src="../../images/close.png" id="accountClear">
			</div>
			<div class="commStyle">
				<label>密码：</label>
				<input type="password"  placeholder="请输入您的密码" id="password" oninput="checkValue()" autocomplete="off" onkeyup="value=value.replace(/[\W]/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" />
				<img src="../../images/close.png" id="passwordClear">
			</div>
			<div class="commStyle"  id="forgetPasswordDiv">
				<span id="forgetPassword">忘记密码</span>
			</div>
			<div class="mui-content-padded">
				<button  class="mui-btn mui-btn-block" id="operateLogin">立即登录</button>
				<!--<button id='regLogin' class="mui-btn mui-btn-block">开通外盘期货账户</button>-->
			</div>
			<div class="commStyle"  id="resigterDiv">
				<a id='reg' href="javascript:void(0)">注册账号</a>
			</div>
		</div>
	</div>
	<script src="../../js/jquery-1.11.3.js"></script>
	<script>
		
	</script>
</body>
</html>