<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="../../js/mui.min.js"></script>
		 <script src="../../js/common.js"></script>
		 <script type="text/javascript" src="../../js/common.config.js" ></script>
		 <script type="text/javascript" src="../../js/jquery-1.11.3.js" ></script>
		 <script type="text/javascript" src="../../js/jquery.base64.js" ></script>
		 <script type="text/javascript" src="../../js/trade.send.js" ></script>
		 <script type="text/javascript" src="../../js/util.js" ></script>
		<link rel="stylesheet" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/quotation.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav own-topbg">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left quotationBack" id = "backClose" ></a>
		<h1 class="mui-title">操盘登录</h1>		
		<!--<a href="javascript:void(0)" class="top-tel" id="telBtn">客服热线</a>-->
	</header>
	<div class="mui-content operateLogin">
		<form  class="mui-input-group blackBg">
			<div class="mui-input-row">
				<label>操盘账号</label>
				<input id='account' type="text" class="mui-input-clear mui-input" placeholder="请输入您操盘账号" >
			</div>
			<div class="mui-input-row mui-password">
				<label>登录密码</label>
				<input id="password" type="password" class="mui-input-password" placeholder="请输入您账号密码" autocomplete="off" onkeyup="value=value.replace(/[\W]/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))" >
			</div>	
		</form>
		<div class="mui-content-padded">
			<button  class="mui-btn mui-btn-block lg-btnlogin" id="operateLogin">立即登录</button>
			<div class="link-area"><a id='forgetPassword' href="javascript:void(0)">忘记密码</a><a id='regLogin' href="javascript:void(0)">没有账号？<span>立即申请</span></a>
			</div>
		</div>
		<!--<div class="mui-content-padded">
			<p class="RegistrationTips"><input name="checkbox" value="Item 1" type="checkbox" checked id="loginCheckbox">阅读并接受<a href="javascript:void(0);" id="tzdr_info" style="color: #FFCC33;">《维胜行情交易协议》</a></p>
		</div>-->
		<div class="mui-input-row mui-checkbox mui-left mui-content-padded" id="loginIform">
				<input name="checkbox" type="checkbox"  id="checkBox"  value="1" checked="checked">
				<p id="loginAgree">阅读并接受<a href="javascript:void(0);" id="tzdr_info" style="color: #FFCC33;">《维胜行情交易协议》</a></p>
			</div>
	</div>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function(){
				var islogin = false;
				var num=0
				$("#checkBox").click(function(){
					if(num==0){
						$("#checkBox").val(2);
						num=1
					}else{
						$("#checkBox").val(1);
						num=0;
					}
					
//					console.log($("#checkBox").val())
				})
				/**
				 * 登录超时处理 
				 */
				function setTimeOutIsLogin(){
					setTimeout(function(){
						if(!islogin){
							plus.nativeUI.closeWaiting();
							mui.toast("网络不给力");
						}
					},10000);
				}
				var Transfer=plus.webview.currentWebview();
				var commdityNo = Transfer.commdityNo;
				var account = null;
				var pwd = null;
				document.getElementById("regLogin").addEventListener("tap",function(){
					var url = "";
					var urlId = "";
					switch(commdityNo){
						//A50
						case  "CN":
								url = "../future/cn.html";
								urlId = "cn";
							break;
						//恒指
						case  "HSI":
								url = "../future/hsi.html";
								urlId = "hsi";
							break;
						//原油
						case  "CL":
								url = "../future/cl.html";
								urlId = "cl";
							break;
						default:
								url = "../future/cp.html";
								urlId = "cp";
							break;
					}
					mui.openWindow({
									url:url,
									id:urlId
								});
				});
				document.getElementById("forgetPassword").addEventListener("tap",function(){
					mui.callService();
				});
				document.getElementById("backClose").addEventListener("tap",function(){
					backReload(); 
				});
				var loginSocket = new WebSocket(TradeUrl.SocketUrl);
				loginSocket.onopen = function(){
				}
				loginSocket.onmessage = function(evt){
					var dataString = evt.data;
					var data = JSON.parse(dataString);
					var method = data.Method;
					var parameters = data.Parameters;
					if (method == "OnRspLogin") {
						var code = parameters.Code;
						var loginMessage = parameters.Message;
						if (code == 0) {
							 backReload();
							localStorage.setItem("account",account);
							localStorage.setItem("password",pwd);
							plus.nativeUI.closeWaiting();
							mui.toast("登录成功");
							islogin = true;
							if (Transfer.backpageID){
		      					mui.app_back(Transfer.backpageID,true);   //放回businessPageId页面，并且刷新该页面信息
		      					return;
      						}
						} else {
							alertProtype(loginMessage,"提示",Btn.confirmed());
							plus.nativeUI.closeWaiting();
						}
					} 
				}
				$("#operateLogin").click(function(){
					if(username == null){
						account=document.getElementById("account").value;
						if($("#checkBox").val()==1){
						        
						}else{
						     mui.toast("请选择协议"); 
						   return;
						  };
						pwd=$.base64.encode(document.getElementById("password").value);
						if(mui.isnull(account)){
			    			mui.toast("请输入账号");
			    			return;
							};
			
						if(mui.isnull(pwd)){
			    			mui.toast("请输入密码");
			    			return;
						}
						loginSendMessage(TradeUrl.LoginUrl,'{"ClientNo":"'+account+'","PassWord":"'+pwd+'"}'); 
						plus.nativeUI.showWaiting( "正在登录中" );
						setTimeOutIsLogin();
					}else{
						alertProtype("你已登录,请勿重复登录","提示",Btn.confirmed());
					}
				});
				function loginSendMessage(method,parameters){
	    			loginSocket.send('{"Method":"'+method+'","Parameters":'+parameters+'}');
				}
				function backReload(){
					plus.webview.getWebviewById("transactionDetails").reload();
				};
				document.getElementById("tzdr_info").addEventListener("tap",function(){
					mui.openWindow({
						url:"../agree/tradingMarket.html",
						id:"tradingMarket"
					})
				})
			});
			
		</script>
	</body>

</html>