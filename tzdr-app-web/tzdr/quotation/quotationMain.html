<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="../../js/mui.min.js"></script>
		 <script src="../../js/common.js"></script>
		 <script type="text/javascript" src="../../js/common.config.js" ></script>
		<link rel="stylesheet" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/own.css" />
		<link rel="stylesheet" href="../../css/quotation.css" />
		
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <h1 class="mui-title" id="quotationTitle"><span>行情交易</span></h1>
		</header>
	<nav class="navlist">
		<a class="navon" href="javascript:void(0);" id="quotationMain">
			<span class="mui-icon"><img src="../../images/0.0.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label">行情交易</span>
		</a>
		<a class="" href="javascript:void(0);"  id="product">
			<span class="mui-icon"><img src="../../images/1.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label">操盘申请</span>
		</a>
		<a class="" href="javascript:void(0);"  id="scheme">
			<span class="mui-icon"><img src="../../images/2.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label">操盘记录</span>
		</a>
		<a class="" id="account" href="javascript:void(0);">
			<span class="mui-icon"><img src="../../images/3.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label" >账户</span>
		</a>
	</nav>
	<div class="mui-content">
		<div id="fisrtLlist"><span>合约名称</span><span>最新价</span><span>成交量</span><span>涨跌幅</span></div>
		<div class="productList">
			<a class='openPage'>
			<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
				<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName ">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
				</a>
				<a class='openPage'>
			<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
				<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
			<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
				<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
			<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
				<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
			<div class="productContentLeft" class="mui-col-xs-3">
				<p class="productName">-</p>
				<p class="grayFont CommodityNo">-</p>
			</div>
			<div class="productContentRight" class="mui-col-xs-9">
				<span class=" QLastPrice">-</span>
				<span class="LastVolume">-</span>
				<span ><p class=" ChangeRate">-</p></span>
			</div>
			</a>
			<a class='openPage'>
				<div class="productContentLeft" class="mui-col-xs-3">
					<p class="productName">-</p>
					<p class="grayFont CommodityNo"><span class="CommodityNoName">-</span>-</p>
				</div>
				<div class="productContentRight" class="mui-col-xs-9">
					<span class=" QLastPrice">-</span>
					<span class="LastVolume">-</span>
					<span ><p class=" ChangeRate">-</p></span>
				</div>
			</a>
		</div>
	</div>
		<script type="text/javascript">
		//初始化导航栏
			tzdr.init.initHearListener();
  			tzdr.init.initButtomListener(true);
			mui.init();
			mui.plusReady(function(){
				//链接socket;
				var url = marketSocketUrl;
					var socket = new WebSocket(url);
					function sendMessage(method,parameters){
					    socket.send('{"Method":"'+method+'","Parameters":'+parameters+'}');
					}
					socket.onopen = function(evt){
					    var user = marketUserName;
					    var pwd = marketPassword;
					    socket.send('{"Method":"Login","Parameters":{"UserName":"' + user +'","PassWord":"' + pwd +'"}}');
					};
					//设置变量
					var CommodityName=[];
					var CommodityNo1=[];
					var CommodityNo2=[];
					var DotSize=[];
					var ExchangeNo=[];
					var MiniTikeSize=[];
					var ContractSize = [];
					var product={
					    CommodityName:CommodityName,
					    CommodityNo1:CommodityNo1,
					    CommodityNo2:CommodityNo2,
					    DotSize:DotSize,
					    ExchangeNo:ExchangeNo,
					    MiniTikeSize:MiniTikeSize,
					    ContractSize:ContractSize
					}
					socket.onclose = function(evt){
						console.log("关闭连接");
					};
					socket.onmessage = function(evt){
					    var data = evt.data;
					    var jsonData = JSON.parse(data);
					    var method = jsonData.Method;
					    if(method=="OnRspLogin"){
					    	  sendMessage('QryCommodity',null)
					    }else if(method == "OnRspQryCommodity"){
					        var commoditys = jsonData.Parameters;
					        var size = commoditys.length;
					        var setTime=null;			          
					        for(var i=0;i<size;i++){
					            product.CommodityName[i]=commoditys[i].CommodityName;
					            product.CommodityNo1[i]=commoditys[i].MainContract;
					            product.CommodityNo2[i]=commoditys[i].CommodityNo;
					           	product.DotSize[i]=commoditys[i].DotSize;
					           	product.ExchangeNo[i]=commoditys[i].ExchangeNo;
					           	product.MiniTikeSize[i]=commoditys[i].MiniTikeSize;
					            product.ContractSize[i]=commoditys[i].ContractSize;
					            socket.send('{"Method":"Subscribe","Parameters":{"ExchangeNo":"'+commoditys[i].ExchangeNo+'","CommodityNo":"'+commoditys[i].CommodityNo+'","ContractNo":"'+commoditys[i].MainContract+'"}}');
					        }
					        //插入主力合约
					        AddTo()
					    }else if(method == "OnRtnQuote"){	
					         var MoreData=JSON.parse(evt.data);
					         //更新行情的数据
//					         console.log(JSON.stringify(evt.data));
					        	insertData1(MoreData);
					    }
					};
					socket.onerror = function(evt){
					};
					//行情产品的插入
				function AddTo(){
				    var productList=document.getElementsByClassName("productList")[0];
				     productList.innerHTML="";
				    for(var i=0;i<product.CommodityName.length;i++){
           				 productList.innerHTML+="<a class='openPage'><div class='productContentLeft mui-col-xs-3' >" +
                    " <p class='productName'>"+product.CommodityName[i]+"</p> " +
                    "<p class='grayFont CommodityNo'><span class='CommodityNoName'>"+product.CommodityNo2[i]+"</span>"+product.CommodityNo1[i]+"</p>" +
                    " </div> " +
                    "<div class='productContentRight' class='mui-col-xs-9'> " +
                    "<span class='reenFont QLastPrice'>-</span> <span class='LastVolume'>-</span> <span class='ChangeRate'><p>-</p></span> </div></a>"
						
						
    				};
    				//生成页面传递的数据
    				function ManufacturingData(i){
    					var data=[];
    					return data=[product.CommodityName[i],product.CommodityNo1[i],product.CommodityNo2[i],product.ExchangeNo[i],product.DotSize[i],product.ContractSize[i],product.MiniTikeSize[i]];
    				};
    				var data0=new ManufacturingData(0);
    				var data1=new ManufacturingData(1);
    				var data2=new ManufacturingData(2);
    				var data3=new ManufacturingData(3);
    				var data4=new ManufacturingData(4);
    				var data5=new ManufacturingData(5);
    				var data6=new ManufacturingData(6);
    				var data7=new ManufacturingData(7);
    				var data8=new ManufacturingData(8);
    				var data9=new ManufacturingData(9);
    				var pageOpen= document.getElementsByClassName("openPage");
    				addListener();
    				//添加产品的点击事件 
    				function addListener(){
    						pageOpen[0].addEventListener("tap",function(){
								socket.close();
								mui.openWindow({
									url:"transactionDetails.html",
									id:"transactionDetails.html",
									 extras:{
										name:data0,
									}
								});
								});
								pageOpen[1].addEventListener("tap",function(){
									socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data1,
										}
									});
								});
								pageOpen[2].addEventListener("tap",function(){
									socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data2,
										}
									});
								});
								pageOpen[3].addEventListener("tap",function(){
									 socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data3,
										}
									});
								});
								pageOpen[4].addEventListener("tap",function(){
									socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data4,
										}
									});
								});
								pageOpen[5].addEventListener("tap",function(){
									socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data5,
										}
									});
								});
								pageOpen[6].addEventListener("tap",function(){
									socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data6,
										}
									});
								});
								pageOpen[7].addEventListener("tap",function(){
									socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data7,
										}
									});
								});
								pageOpen[8].addEventListener("tap",function(){
									socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data8,
										}
									});
								});
								pageOpen[9].addEventListener("tap",function(){
								socket.close();
									mui.openWindow({
										url:"transactionDetails.html",
										id:"transactionDetails.html",
										 extras:{
											name:data9,
										}
									});
								});
    				};
				
				};
				//插入行情的方法
			 function insertData1(MoreData) {
			 	if(MoreData.Parameters.CommodityNo=="CN"){
			 		//console.log("123")
			 		//console.log(MoreData.Parameters.TotalVolume);
			 	}
			 		
			        var productName = document.getElementsByClassName("productName");
			        var CommodityNo = document.getElementsByClassName("CommodityNo");
			        var LastVolume = document.getElementsByClassName("LastVolume");
			        var ChangeRate = document.getElementsByClassName("ChangeRate");
			        var LastPrice = document.getElementsByClassName("QLastPrice");
			        var productContentLeft = document.getElementsByClassName("CommodityNoName");
			        for (var i = 0; i < productContentLeft.length; i++) {          
			            if (MoreData.Parameters.CommodityNo == productContentLeft[i].innerHTML) {
			                LastVolume[i].innerText = MoreData.Parameters.TotalVolume;
			                if (Number(MoreData.Parameters.ChangeRate.toFixed(4)) < 0) {
			                    ChangeRate[i].innerText = MoreData.Parameters.ChangeRate.toFixed(2) + "%";
			                    ChangeRate[i].className = "greenBg ChangeRate";
			                } else {
			                    ChangeRate[i].innerText = "+" + MoreData.Parameters.ChangeRate.toFixed(2) + "%";
			                    ChangeRate[i].className = "redBg ChangeRate";
			                }
			                if (Number(MoreData.Parameters.LastPrice) - Number(MoreData.Parameters.PreSettlePrice) < 0) {
			                    LastPrice[i].innerText = MoreData.Parameters.LastPrice.toFixed(product.DotSize[i]);
			                    LastPrice[i].className = "greenFont QLastPrice";
			                } else {
			                    LastPrice[i].innerText = MoreData.Parameters.LastPrice.toFixed(product.DotSize[i]);
			                    LastPrice[i].className = "redFont QLastPrice";
			                }
			
			            }
			        }
			    }
			document.getElementById("product").addEventListener("tap",function(){
					socket.close();
			});
			document.getElementById("scheme").addEventListener("tap",function(){
					socket.close();
			});
			document.getElementById("account").addEventListener("tap",function(){
					socket.close();
			})
			});
		</script>
	</body>
</html>