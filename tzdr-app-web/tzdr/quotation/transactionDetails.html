<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>交易</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="../../js/mui.min.js"></script>
		 <script src="../../js/common.js"></script>
		<link rel="stylesheet" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/quotation.css" />
		<!--<link rel="stylesheet" href="../../css/own.css" />-->
		<script type="text/javascript" src="../../js/jquery-1.11.3.js" ></script>
		<script src="../../js/esl.js"></script>
		<style>
			.mui-bar-nav{
				border-bottom: 1px solid #121212;
			}
			#popover{
				min-width: 282px;
				height: 190px ;
				top:50% !important;
				margin-top: -120px;
				left: 50% !important;
				margin-left: -141px;
			}
			@media (min-width: 400px){
				#popover{
					width: 80%;
					margin-left: -40%;
				}
			}
			
			.mui-popover .mui-popover-arrow{
				display: none !important;
			}
			.mui-input-row label{
				width: 45%;
				padding:11px 0px 11px 15px;
				height: 40px;
				font-size: 14px;;
			}
			.mui-input-row label~input, .mui-input-row label~select, .mui-input-row label~textarea{
				width: 55%;
				height: 40px;
				font-size: 14px;;
			}
			#add,#clsoeAdd{
				width: 45%;
				margin-top: 10px;
				display: inline-block;
				border: none;
				height: 40px;
				padding: 0px;
				line-height: 40px;
			}
			#add{
				background-color: #fcc900;
				color:#2b2b2b;
				margin-left: 10px;
				margin-right: 5px;
			}
			#clsoeAdd{
				background-color: #cccccc;
				color:#2b2b2b;
			}
		</style>
	</head>
	<body style="background-color: #2B2B2B"> 
		<header class="mui-bar mui-bar-nav"> 
		    <a class="mui-icon mui-icon-left-nav mui-pull-left quotationBack mui-action-back" id= "backClose"><i>返回</i></a>
		    <h1 class="mui-title mainTitle"><p class="mainTitleFirst"></p><p id="CommodityNo"></p></h1>
		    <a class="whiteFont" id="switchAccount">切换账号</a>
		</header>
		<div class="mui-content" style="padding-top: 86px;" >
				<div id="headerMenu" style="background-color: #2B2B2B;">
					<table cellpadding="0" cellspacing="0">
						<thead>
							<tr>
								<td id="tradeMenu" >交易中心</td>
								<td id="HandicapButton">盘口</td>
								<td  id="timeChartMenu" value="0" class="mui-active">分时</td>
								<td id="selectButon">K线</td>
							</tr>
						</thead>
					</table>
				</div>
				<div id="headerContent">
					<div id="chartAllDiv" class="bottomDivList mui-active">
						<div class="chartDivContent mui-active" id="TimeChart1">
							<div id="timeChart" style="width:100%;"></div>
							<div id="volumeChart" style="width:100%;"></div>
						</div>
						<div class="chartDivContent" id="CandlestickChart" style="opacity: 0;">
							<div   id="CandlestickChartDiv" style="width:100%;"></div>
							<div id="CandlestickVolumeChart" style="width:100%;"></div>
						</div>
						<div class="buttomFix" style="position: fixed;bottom: 0px;height:211px ;">
							<div class="buttomFixLeft mui-col-xs-6">
								<p>卖<span id="buyPrices" class="PricesLeft">-</span ><span id="buyPricesNumber" class="PricesRight">-</span></p>
								<p>买<span id="sellPrices" class="PricesLeft">-</span ><span id="sellPricesNumber" class="PricesRight">-</span></p>
								<p>成交量<span id="volumePricesNumber" class="PricesRight">-</span></p>
							</div>
							<div class="buttomFixRight mui-col-xs-6">
								<p id="freshPrices">0.00</p> 
								<p id="domnRange"><span id="rose">-</span><span id="changeValue">-</span></p>
							</div>
							<div class="BuyDiv">
								<div id="numberInput">
									<label>手数:</label>
									<input onkeypress="if((event.keyCode<48 || event.keyCode>57)) event.returnValue=false"  value="1" id = "orderNum" type="number">
									<label>（价格：市价）</label>
								</div>
								<!--<div class=""><label></label><input onkeypress="if((event.keyCode<48 || event.keyCode>57)) event.returnValue=false"  value="1" id = "orderNum" type="number"><label>（价格：市价）</label></div>
									<div class="BuyContentLeft"><label>价格:</label><input placeholder="市价" disabled="disabled"></div>-->
							</div>
							<div style="display: none;">
								<input type="text"  id = "exchangeNo"/> 
								<input type="text"  id = "commodeityNo"/>
								<input type="text"  id = "contractNo"/>
								<input type="text"  id = "contractSize" />
								<input type="text"  id= "miniTikeSize"/>
								<input type="text"  id = "doSize"/>
								<input type="text" id="CommodityName" />
								持仓盈亏:<input type="text" value = "0.00" id = "floatingProfit">
							</div>
						</div>
					</div>
					<div id="Handicap" class="bottomDivList">
						<table cellpadding="0" cellspacing="0" id="table_title">
							<thead>
								<tr>
									<td>卖五档</td>
									<td>买五档</td>
								</tr>
							</thead>
						</table>
						<table cellpadding="0" cellspacing="0" id="table_Content">
							<tr>
								<td>卖一</td>
								<td class="redFont">12112.12</td>
								<td>20</td>
								<td>买一</td>
								<td>买一</td>
								<td>买一</td>
							</tr>
							<tr>
								<td>卖一</td>
								<td>12112.12</td>
								<td>20</td>
								<td>买一</td>
								<td>买一</td>
								<td>买一</td>
							</tr>
							<tr>
								<td>卖一</td>
								<td>12112.12</td>
								<td>20</td>
								<td>买一</td>
								<td>买一</td>
								<td>买一</td>
							</tr>
						</table>
						<table cellpadding="0" cellspacing="0" id="HandicapTable">
							<tr>
								<td>卖价</td>
								<td>68.12</td>
								<td>卖量</td>
								<td>21313</td>
							</tr>
							<tr>
								<td>买价</td>
								<td>68.12</td>
								<td>买量</td>
								<td>21313</td>
							</tr>
							<tr>
								<td>最新 </td>
								<td>68.12</td>
								<td>涨跌</td>
								<td>21313</td>
							</tr>
							<tr>
								<td>开盘 </td>
								<td>68.12</td>
								<td>成交量 </td>
								<td>21313</td>
							</tr>
							<tr>
								<td>最高 </td>
								<td>68.12</td>
								<td>持仓量  </td>
								<td>21313</td>
							</tr>
							<tr>
								<td>最低 </td>
								<td>68.12</td>
								<td>昨结  </td>
								<td>21313</td>
							</tr>
							<tr>
								<td>结算 </td>
								<td>68.12</td>
								<td></td>
								<td></td>
							</tr>
						</table>
					</div>
					<div  id="trade" style="padding-top: 40px; padding-bottom: 20px;" class=" bottomDivList">
					    <div class="Assets" style="background-color: #2B2B2B;">
					        <p class="YellowFont"><span id = "todayBalance">0.00</span><span id = "deposit">0.00</span><span id = "todayCanUse">0.00</span></p>
					        <p><span>总资产</span><span>保证金</span><span>余额</span></p>
					    </div>
					    <div class="ProductInformation">
					        <div class="ProductInformationLeft">
					                <select class="mui-btn mui-btn-block" id = "tradeTitle" >
					                </select>
					                <span id="MainContract"></span>
					            <span class="mui-icon mui-icon-search" id="searchIcon"></span>
					        </div>
					        <div class="ProductInformationRight">
					            <p class="whiteFont">新：<span id = "lastPrice">0.00</span><span class="dataRight" id= "totalVolume">0.00</span></p>
					            <p class="whiteFont">卖：<span id = "sellLastPrice">0.00</span><span class="dataRight" id = "askQty">0.00</span></p>
					            <p class="whiteFont">买：<span id = "buyLastPrice">0.00</span><span class="dataRight" id = "bidQty">0.00</span></p>
					        </div>
					    </div>
					    <form id="buyFuture">
					        <div class="butomBoreder">
					            <div class="mui-input-row mui-radio radioDiv mui-left">
					                <label>市价</label>
					                <input type="radio" id="sj" checked name="prices" value="1" class="radioChoice mui-radio">
					            </div>
					            <div class="mui-input-row mui-radio radioDiv mui-left">
					                <label>限价</label>
					                <input type="radio"  id="xj" class="radioChoice mui-radio" value="0" name="prices">
					            </div>
					        </div>
					        <div class="BuyContentLeft"><label>价格:</label><input  id = "orderPrice" onkeypress="if(event.keyCode!=46 && (event.keyCode<48 || event.keyCode>57)) event.returnValue=false"  disabled="disabled" class = "numberResize"  type="number" placeholder = "市价"></div><div class="BuyContentLeft"><label>手数:</label><input id = "orderNumber"  onkeypress="if((event.keyCode<48 || event.keyCode>57)) event.returnValue=false" class = "numberResize"  value="1" placeholder="1" type="number"></div>
					        <div class="buyBtn">
					            <button type="button" class="mui-btn mui-col-xs-5 buy " id = "buy" data-tion-buy = "0" ><p id="switchBuy">买入</p><p id = "buyBtn_P" class = "buyBtnPrices">市价</p></button>
					            <button type="button" class="mui-btn mui-col-xs-5 buy " id = "sell" data-tion-buy = "1"><p id="switchSell" >卖出</p><p id = "sellBtn_P" class = "buyBtnPrices">市价</p></button>
					        </div>
					    </form>
					    <div id="segmentedControl" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-primary">
					        <a class="mui-control-item mui-active" href="#item1" id = "holdCC">持仓</a>
					        <a class="mui-control-item" href="#item2" id = "desgnateGD">挂单</a>
					        <a class="mui-control-item" href="#item3" id = "tradeWT">委托</a>
					        <a class="mui-control-item" href="#item4" id = "successCJ">成交</a>
					    </div>
					    <div>
					        <div id="item1" class="mui-control-content mui-active" >
					            <ul id="positionList" class="listStyle" style="height: 165px; width: 100%;" >
					                <li class="PositionLi" ><a class="mui-navigate-right"><span>合约名称</span><span>多空</span><span>手数</span><span>持仓均价</span><span class="dateTimeFloat">浮动盈亏</span></a></li>
					            </ul>
					            <button type="button" class="mui-btn mui-col-xs-5 focusButton" id="allOpen">全部平仓</button>
					            <button type="button" class="mui-btn mui-col-xs-5 focusButton" id="Open">平仓</button>
					        </div>
					        <div id="item2" class="mui-control-content">
					            <ul  id="postersOrder" class="listStyle" style="height: 165px; width: 100%;" >
					                <li class="fisrtLi Guadan"><a class="mui-navigate-right"><span>合约名称</span><span>买卖</span><span>委托价</span><span>委托量</span><span>挂单量</span><span class="dateTimeL">挂单时间</span></a></li>
					            </ul>
					             <button type="button" class="mui-btn focusButton" id="fullWithdrawal">全撤</button>
					            <button type="button" class="mui-btn focusButton " id="kilAnorder">撤单</button>
					           <button type="button" class="mui-btn focusButton" id="changeSingle">改单</button>
					        </div>
					        <div id="item3" class="mui-control-content" style="width: 100%;">
					            <ul  id="Entrust" class="listStyle" style="height: 165px;" >
					                <li class="fisrtLi EntrustOreder"><a class="mui-navigate-right" ><span>合约名称</span><span>状态</span><span>买卖</span><span>委托价</span><span>委托量</span><span>已成交</span><span>已撤单</span><span class="dateTimeL">下单时间</span></a></li>
					            </ul>
					        </div>
					        <div id="item4" class="mui-control-content" >
					            <ul  id="Deal" class="listStyle" style="height: 165px;">
					                <li class="DealLi" ><a class="mui-navigate-right" ><span>合约名称</span><span>买卖</span><span>成交价</span><span>成交量</span><span class="dateTimeL">成交时间</span></a></li>
					            </ul>
					        </div>
					    </div>
					</div>
				</div>
				<div class="top"></div><div class="bottom"></div>
				<div id="closeDiv"><img src="../../images/quotationColse.png" id="closeTrade"></div>
				<div id="littleDiv"></div>
				<div id="list_type" >
					<span id="sanjiao"></span>
					<ul >
						<li value="1">1分</li>
						<li value="5">5分</li>
						<li value="15">15分</li>
						<li value="30">30分</li>
						<li value="1440">日K</li>
					</ul>
				</div>
			</div>
			<div class="buttonDivList">
				<button type="button" class="mui-btn marketBuy " id="marketBuy" data-tion-buy = "0">买入</button>
				<button type="button" class="mui-btn  marketBuy" id="marketSell" data-tion-buy = "1">卖出</button>
			</div>
			<div id="popover" class="mui-popover" id="inputDiv">
				<div class="mui-popover-arrow"></div>
				<div class="mui-content-padded">
				<h4 id="title" style="text-align: center;margin-top: 10px;">改单</h4>
					<form class="mui-input-group" style="margin-top: 10px;">
						<div class="mui-input-row">
							<label>委托价格：</label>
							<input type="text" class="mui-input-clear" id="col1" placeholder="请输入">
						</div>
						<div class="mui-input-row">
							<label>委托数量：</label>
							<input type="text" class="mui-input-clear" id="col2" placeholder="请输入">
						</div>
					</form>
					<div id="add_div" class="operate mui-hidden">
						<button type="button" class="mui-btn mui-btn-blue" id="add">确定</button>
						<button type="button" class="mui-btn mui-btn-blue" id="clsoeAdd">取消</button>
					</div>
				</div>
			</div>
			<script>
				mui.plusReady(function(){
				loadCss();
				var Proportion=1;
//				document.getElementById("holdCC").addEventListener("tap",function(){
//					document.getElementById("holdCC").href="#item1"
//				})
    			function loadCss(){
		    			var Proportion=1;
						var screen=plus.screen.resolutionHeight;
							$("#timeChart,#CandlestickChartDiv").css({
								"width":"100%",
								"height":135*screen/568+"px",
							});
							$("#volumeChart,#CandlestickVolumeChart").css({
								"width":"100%",
								"height":110*screen/568+"px",
							});
						}	
					/*
					 增加新手引导的样式
					 */
					if(plus.storage.getItem("QuotationGuidanceTrade")==null){
						plus.storage.setItem("QuotationGuidanceTrade","1");
						bindGuidance();
					}
					function bindGuidance(){
					var height=window.innerHeight;
					var width=window.innerWidth;
						$(".top").css({
							"height":"96px",
							"background-color":"rgba(0,0,0,0.8)",
							"display":"block",
						});
						$("#closeDiv").css({
							"top":4+"px",
							"right":10+"px",
							"display":"block",
						});
						$(".bottom").css({
							"display":"block",
							"height":$(".buttomFix").height()+87+"px",
							"background": "url(../../images/tradeGudice1.png) no-repeat",
							"background-size":"100% 100%",
							"z-index":"991",
						});
						var clickNum=0;
						$(".bottom,.top").click(function(){
							if(clickNum==0){
								$(".bottom").css({
									"height":height-86+"px",
									"bottom":"0px",
									"background-image": "url(../../images/tradeGudice2.png)",
								});
								$(".top").css({
									"height":46+"px",
								});
								$("#littleDiv").css({
									"position":"fixed",
									"top":"46px",
									"left":"0px",
									"width":120+"px",
									"height":50+"px",
									"background-color":"rgba(0,0,0,0.8)",
									"z-index":"992",
								});
							}else if(clickNum==1){
								$(".top").css({
									"display":"none",
								});
								$("#closeDiv").css({
									"left":Proportion*10+"px",
								});
								$(".bottom").css({
									"bottom":"0px",
									"left":"0px",
									"height":height+"px",
									"background-image": "url(../../images/tradeGudice3.png)",
								});
								$("#littleDiv").css({
									"display":"none",
								});
							}else if(clickNum==2){
								$("#closeDiv").css({
									"left":width-40+"px"
								});
								$(".bottom").css({
									"bottom":"50px",
									"left":"0px",
									"height":height-50+"px",
									"background-image": "url(../../images/tradeGudice4.png)",
								});
							}else if(clickNum==3){
								$(".bottom").css({
									"bottom":"0px",
									"left":"0px",
									"height":height+"px",
									"background-image": "url(../../images/tradeGudice5.png)",
								});
							}else{
								$(".bottom").css({
									"display":"none",
								});
								$("#closeDiv").css({
									"display":"none",
								});
							}
							clickNum++;
							
						});
						$("#closeDiv").click(function(){
							$(".top,.bottom,#littleDiv,#closeDiv").css({
			    				"display":"none",
			    			});
						});
						$("#littleDiv").click(function(){
							$(".top,.bottom,#littleDiv,#closeDiv").css({
			    				"display":"none",
			    			});
						})
					$("#closeTrade").click(function(){
						$(".top,.bottom,#littleDiv,#closeDiv").css({
			    			"display":"none",
			    		});
					});
				}
			});
			</script>
		<script type="text/javascript" src="../../js/common.config.js" ></script> 
		<script type="text/javascript" src="../../js/jquery.base64.js" ></script>
		<script type="text/javascript" src="../../js/util.js" ></script>
		<script type="text/javascript" src="../../js/trade.util.js" ></script>
		<script type="text/javascript" src="../../js/trade.data.mode.js" ></script>
		<script type="text/javascript" src="../../js/trade.config.js" ></script>
		<script type="text/javascript" src="../../js/trade.connection.js" ></script>
		<script type="text/javascript" src="../../js/trade.send.js" ></script>
		<script src="../../js/chart.config.js"></script>
		<script src="../../js/timechart.config.js"></script>
		<script src="../../js/candlestick.config.js"></script>
		<script src="../../js/chart.js"></script>
		<script type="text/javascript" src="../../js/trade.js" ></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function(){  
				var Transfer=plus.webview.currentWebview();
				var CommodityNo=document.getElementById("CommodityNo");
				var mainTitleFirst=document.getElementsByClassName("mainTitleFirst")[0];
				mainTitleFirst.innerHTML=Transfer.name[0];
				CommodityNo.innerHTML=Transfer.name[2]+Transfer.name[1];
				var candlestickChartItem = document.getElementById('CandlestickChart');
				init(Transfer.name);
				cachTranFers(Transfer.name);
				var i = 0 ;
				$(window).resize(function() {
					if(i % 2 == 0){  
						 $(".focusButton").css("display","none");
					}else{
						$(".focusButton").css("display","block");
					}
					i++; 
				});
				if(localStorage.getItem("isMock")==1){
					$("#marketBuy").text("模拟买入");
					$("#switchBuy").text("模拟买入");
					$("#marketSell ").text("模拟卖出");
					$("#switchSell").text("模拟卖出");
				}
					var col1 = document.getElementById("col1");
					var col2 = document.getElementById("col2");
					var network = false;
					var add_div = document.getElementById("add_div");
				document.getElementById("fullWithdrawal").addEventListener("tap",function(){
						//清空数据
						col1.value = "";
						col2.value = "";
						add_div.classList.remove("mui-hidden");
						mui("#popover").popover("toggle");
				})
				function trim(str){ //删除左右两端的空格
			　　     return str.replace(/(^\s*)|(\s*$)/g, "");
			　　 }
				document.getElementById("clsoeAdd").addEventListener("tap",function(){
						mui("#popover").popover("toggle");
				})
				document.getElementById("add").addEventListener('tap', function() {
					var check = true;
					mui(".mui-input-group input").each(function () {
						if(!this.value||trim(this.value)==""){
							var label = this.previousElementSibling;
							mui.alert(label.innerText+"不允许为空");
							check = false;
							return false;
						}
					});
					if(check){
						add_div.classList.add("mui-hidden");
						//关闭modal
						mui("#popover").popover("toggle");
						mui.toast("添加成功~");
						//刷新界面
					}
				
				});
			});
		</script>
		<script>
		
			var tranferParam = null ;
			/**
			 * 获取行情请求的数据-并初始化页面 
			 */
//			$(function(){
//				plus.nativeUI.showWaiting( "正在加载内容" );
//			})
			function setTimeOutInsertOrder(){
				tradeSetTimeOut = setTimeout(function(){
								plus.nativeUI.closeWaiting(); 
							},10000);
			}
			function init(param){
				$("#exchangeNo").val(param[3]);
				$("#commodeityNo").val(param[2]);
				$("#contractNo").val(param[1]);
				$("#contractSize").val(param[5]);
				$("#lastPrice").text(param[7]);
//				$("#lastPriceNone").val(param[7]);
				$("#miniTikeSize").val(param[6]);
				$("#doSize").val(param[4]);
			}
			function cachTranFers(param){ 
				tranferParam = param;
			}
			var loginOutFlag = false;
			var loginOutTip=false;
			$(function(){ 
				$("#orderPrice").bind("input",function(){
					var orderPrice = $(this).val(); 
					if(orderPrice == undefined || orderPrice.length == 0){
						orderPrice = 0;
					}
					$("#buyBtn_P").text(orderPrice);
					$("#sellBtn_P").text(orderPrice);
				});
				$('#password').bind('input propertychange', function() {
				  	var orderPrice = $("#orderPrice").val();
				  	$("#buyBtn_P").val(orderPrice);
				  	$("#sellBtn_P").val(orderPrice);
				});
				$("input[type='radio']").click(function(){
					var type = $("input[type = 'radio']:checked").val();
					var orderPrice = $("#orderPrice");
					var lastPrice = $("#lastPrice").text();
					var miniTikeSize = $("#miniTikeSize").val();
					var doSize = $("#doSize").val();
					if(type == 1){  
						$("#buyBtn_P").text("市价");
						$("#sellBtn_P").text("市价");
						orderPrice.prop("placeholder","市价");
						orderPrice.prop("value",""); 
						orderPrice.prop("disabled",true);
					}else{
						orderPrice.prop("disabled",false);
						orderPrice.prop("value",lastPrice); 
						$("#buyBtn_P").text(lastPrice);
						$("#sellBtn_P").text(lastPrice);
						orderPrice.prop("placeholder","");
					}
				});
				if(username == null){
					$("#switchAccount").text("登录账号");
				}
			});
			
	</script>
	</body>

</html>
