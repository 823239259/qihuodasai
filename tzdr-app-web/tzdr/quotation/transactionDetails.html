<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>交易</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="../../js/mui.min.js"></script>
		 <script src="../../js/common.js"></script>
		<link rel="stylesheet" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/quotation.css" />
		<script type="text/javascript" src="../../js/jquery-1.11.3.js" ></script>
		<script src="../../js/esl.js"></script>
	</head>
	<body style="background-color: #2B2B2B"> 
		<header class="mui-bar mui-bar-nav"> 
		    <a class="mui-icon mui-icon-left-nav mui-pull-left quotationBack" id= "backClose"></a>
		    <h1 class="mui-title mainTitle"><p class="mainTitleFirst"></p><p id="CommodityNo"></p></h1>
		    <a class="whiteFont" id="switchAccount">切换账号</a>
		</header>
		<div class="mui-content">
				<div class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-primary">
					<a class="mui-control-item mui-active" id="Time" href="#TimeChart1">分时</a>
					<a class="mui-control-item " id="Candlestick" href="#CandlestickChart">分K</a>
					<a class="mui-control-item " id="dayCandlestickBtn" href="#dayCandlestickChart">日K</a>
					<a class="mui-control-item" id="TradingCenter"  >交易中心</a>
					</div>
				<div style="width: 100%;" id="tradeContentId">
						<div class="mui-control-content  mui-active" id="TimeChart1">
								<div class="mui-spinner" style="position: absolute;top:110px;left: 45%;">
								</div>
								<div id="timeChart" style="width:100%;height:130px;"></div>
								<div id="volumeChart" style="width:100%;height:130px;"></div>
						</div>
						<div class="mui-control-content " id="CandlestickChart" style="opacity: 0;">
								<div class="mui-spinner" style="position: absolute;top:110px;left: 45%;">
								</div>
								<div   id="CandlestickChartDiv" style="width:100%;height:130px;"></div>
								<div id="CandlestickVolumeChart" style="width:100%;height:130px;"></div>
						</div>
						<div class="mui-control-content " id="dayCandlestickChart" style="opacity: 0;">
								<div class="mui-spinner" style="position: absolute;top:110px;left: 45%;">
								</div>
								<div   id="dayCandlestickChartDiv" style="width:100%;height:130px;"></div>
								<div id="dayCandlestickVolumeChart" style="width:100%;height:130px;"></div>
						</div>
						<div class="mui-control-content " id="trade">
							<div class="Assets">
								<p class="YellowFont"><span id = "todayBalance">0.00</span><span id = "deposit">0.00</span><span id = "todayCanUse">0.00</span></p>
								<p><span>总资产</span><span>保证金</span><span>余额</span></p>
							</div>
							<div class="ProductInformation">
								<div class="ProductInformationLeft">
									<p class="whiteFont" >
										<!--<p id = "tradeTitle" ><span id="titleValue"></span><span class="mui-icon mui-icon-search" id="searchIcon"></span></p>
											<ul id="contentList">
												
											</ul>-->
											<div id="bb">
												<select class="mui-btn mui-btn-block" id = "tradeTitle" >
													<!--<option>1243</option>-->
												</select>
											</div>
										
										<span class="mui-icon mui-icon-search" id="searchIcon"></span>
									</p>
									<!--<p class="grayFont" id = "tradeContractTitle">CNQ16</p>-->
								</div>
								<div class="ProductInformationRight">
									<p class="whiteFont">新：<span id = "lastPrice">0.00</span><span class="dataRight" id= "totalVolume">0.00</span></p>
									<p class="whiteFont">卖：<span id = "sellLastPrice">0.00</span><span class="dataRight" id = "askQty">0.00</span></p>
									<p class="whiteFont">买：<span id = "buyLastPrice">0.00</span><span class="dataRight" id = "bidQty">0.00</span></p>
								</div>
							</div>
							<form id="buyFuture">
								<div class="butomBoreder">
									<div class="mui-input-row mui-radio radioDiv mui-left">
									<label>市价</label>
									<input type="radio" checked name="prices" value="1" class="radioChoice mui-radio">
								</div>
								<div class="mui-input-row mui-radio radioDiv mui-left">
									<label>限价</label>
									<input type="radio" class="radioChoice mui-radio" value="0" name="prices">
								</div>
								</div> 
								
								<!--<span><input type="radio" checked name="prices" value="1" class="radioChoice mui-radio"><label>快手板</label></span><span><input type="radio" class="radioChoice mui-radio" value="0" name="prices"><label>限价板</label></span>-->
								<div class="BuyContentLeft"><label>价格:</label><input  id = "orderPrice" onkeypress="if(event.keyCode!=46 && (event.keyCode<48 || event.keyCode>57)) event.returnValue=false"  disabled="disabled" class = "numberResize"  type="number" placeholder = "市价"></div><div class="BuyContentLeft"><label>手数:</label><input id = "orderNumber"  onkeypress="if((event.keyCode<48 || event.keyCode>57)) event.returnValue=false" class = "numberResize"  value="1" placeholder="1" type="number"></div>
								<div class="buyBtn">
								<button type="button" class="mui-btn mui-col-xs-5 buy " id = "buy" data-tion-buy = "0" ><p>买</p><p id = "buyBtn_P" class = "buyBtnPrices">0.00</p></button>
								<button type="button" class="mui-btn mui-col-xs-5 buy " id = "sell" data-tion-buy = "1"><p >卖</p><p id = "sellBtn_P" class = "buyBtnPrices">0.00</p></button>
								</div>
							</form>
							<div id="segmentedControl" class="mui-segmented-control mui-segmented-control-inverted mui-segmented-control-primary">
								<a class="mui-control-item mui-active" href="#item1" id = "holdCC">持仓</a>
								<a class="mui-control-item" href="#item2" id = "desgnateGD">挂单</a>
								<a class="mui-control-item" href="#item3" id = "tradeWT">委托</a>
								<a class="mui-control-item" href="#item4" id = "successCJ">成交</a>
							</div>
				<div>
					<div id="item1" class="mui-control-content mui-active" >
							<ul id="positionList" class="listStyle" style="height: 180px; width: 100%;" >
								<li class="PositionLi" ><a class="mui-navigate-right"><span>合约名称</span><span>多空</span><span>手数</span><span>开仓均价</span><span class="dateTimeFloat">浮动盈亏</span></a></li>
							</ul>
						<button type="button" class="mui-btn mui-col-xs-5 focusButton" id="allOpen">全部平仓</button>
						<button type="button" class="mui-btn mui-col-xs-5 focusButton" id="Open">平仓</button>
					</div>
					<div id="item2" class="mui-control-content">
							<ul  id="postersOrder" class="listStyle" style="height: 180px; width: 100%;" >
								<li class="fisrtLi Guadan"><a class="mui-navigate-right"><span>合约名称</span><span>买卖</span><span>委托价</span><span>委托量</span><span>挂单量</span><span class="dateTimeL">挂单时间</span></a></li>
							</ul>
							<button type="button" class="mui-btn mui-col-xs-10 focusButton" id="kilAnorder">撤单</button>
					</div>
					<div id="item3" class="mui-control-content" style="width: 100%;">
							<ul  id="Entrust" class="listStyle" style="height: 180px;" >
								<li class="fisrtLi EntrustOreder"><a class="mui-navigate-right" ><span>合约名称</span><span>状态</span><span>买卖</span><span>委托价</span><span>委托量</span><span>已成交</span><span>已撤单</span><span class="dateTimeL">下单时间</span></a></li>
							</ul>
					</div>
					<div id="item4" class="mui-control-content" >
							<ul  id="Deal" class="listStyle" style="height: 180px;">
								<li class="DealLi" ><a class="mui-navigate-right" ><span>合约名称</span><span>买卖</span><span>成交价</span><span>成交量</span><span class="dateTimeL">成交时间</span></a></li>
								<!--<li style="width: 600px;"><a class="mui-navigate-right" ><p><span>美原油09</span><span>买</span><span>1</span><span>2</span><span>2016.08.08 18:03:11</span></p></a></li>-->
							</ul>
					</div>
					</div>
				</div>
			</div>
		</div>
			<div class="buttomFix">
				<div class="buttomFixLeft mui-col-xs-6">
					<p>卖<span id="buyPrices" class="PricesLeft">-</span ><span id="buyPricesNumber" class="PricesRight">-</span></p>
					<p>买<span id="sellPrices" class="PricesLeft">-</span ><span id="sellPricesNumber" class="PricesRight">-</span></p>
					<p>成交量<span id="volumePricesNumber" class="PricesRight">-</span></p>
				</div>
				<div class="buttomFixRight mui-col-xs-6">
					<p id="freshPrices">0.00</p>
					<p id="domnRange"><span id="rose">-</span><span id="changeValue">-</span></p>
				</div>
				<div class="BuyDiv">
				<div class="BuyContentLeft"><label>手数:</label><input onkeypress="if((event.keyCode<48 || event.keyCode>57)) event.returnValue=false"  value="1" id = "orderNum" type="number"></div><div class="BuyContentLeft"><label>价格:</label><input placeholder="市价" disabled="disabled"></div>
				</div>
				<div class="buyBtn">
					<button type="button" class="mui-btn mui-col-xs-5 marketBuy " id="marketBuy" data-tion-buy = "0">买入</button>
					<button type="button" class="mui-btn mui-col-xs-5 marketBuy" id="marketSell" data-tion-buy = "1">卖出</button>
				</div>
				<div style="display: none;">
				<!--<input type="text"  id = "lastPriceNone" />-->
				<input type="text"  id = "exchangeNo"/> 
				<input type="text"  id = "commodeityNo"/>
				<input type="text"  id = "contractNo"/>
				<input type="text"  id = "contractSize" />
				<input type="text"  id= "miniTikeSize"/>
				<input type="text"  id = "doSize"/>
				<input type="text" id="CommodityName" />
			</div>
		</div>
		<script type="text/javascript" src="../../js/common.config.js" ></script>
		<script type="text/javascript" src="../../js/jquery.base64.js" ></script>
		<script type="text/javascript" src="../../js/trade.data.model.js" ></script>
		<script type="text/javascript" src="../../js/trade.send.js" ></script>
		<script type="text/javascript" src="../../js/util.js" ></script>
		<script src="../../js/chart.config.js"></script>
		<script src="../../js/timechart.config.js"></script>
		<script src="../../js/candlestick.config.js"></script>
		<script src="../../js/dayCandlestick.config.js"></script>
		<script src="../../js/chart.js"></script>
		<script type="text/javascript" src="../../js/trade.js" ></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function(){  
				var Transfer=plus.webview.currentWebview();
				var CommodityNo=document.getElementById("CommodityNo");
				var mainTitleFirst=document.getElementsByClassName("mainTitleFirst")[0];
				mainTitleFirst.innerHTML=Transfer.name[0];
				CommodityNo.innerHTML=Transfer.name[2]+Transfer.name[1];
				document.getElementById("TradingCenter").addEventListener("tap",function(){
					if(vadationIsLogin()){
						document.getElementsByClassName("buttomFix")[0].style.display="none";
						document.getElementById("tradeContentId").style.display = "block";
						$("#TradingCenter").prop("href","#trade");
					}
				});
				document.getElementById("Time").addEventListener("tap",function(){
					document.getElementsByClassName("buttomFix")[0].style.display="block";
				});
				document.getElementById("trade").addEventListener("tap",function(){
					$("#CandlestickChart").css("opacity","0");
    				$("#TimeChart1").css("opacity","0");
    					$("#dayCandlestickChart").css("opacity","0");
				})
				var candlestickChartItem = document.getElementById('CandlestickChart');
				init(Transfer.name);
				cachTranFers(Transfer.name);
				var i = 0 ;
				$(window).resize(function() {
					if(i % 2 == 0){  
						 $(".focusButton").css("display","none");
					}else{
						$(".focusButton").css("display","block");
					}
					i++; 
				});
				/*document.getElementById("searchIcon").addEventListener("tap",function(){
					$("#contentList").css("display","block");
				})
				document.getElementById("titleValue").addEventListener("tap",function(){
					$("#contentList").css("display","block");
				})
				document.getElementById("contentList").addEventListener("tap",function(){
					str= $(this).index();
			         console.log(str) ;
				})
				 $('#contentList li').on('click',function(){
			        str= $(this).index();
			         console.log(str) ;
			 
			    })
				$("#contentListBg").css({"height":window.innerHeight+"px","background-color":"rgba(0, 0, 0, 0.2)"});
				var leftWidth=window.innerWidth/2-150;
				$("#contentListBg").css({"top":window.innerHeight/2-120+"px","left":leftWidth+"px"});*/
			});
			
		</script>
		<script>
			var tranferParam = null ;
			/**
			 * 获取行情请求的数据-并初始化页面 
			 */
//			$(function(){
//				plus.nativeUI.showWaiting( "正在加载内容" );
//			})
			function setTimeOutInsertOrder(){
				tradeSetTimeOut = setTimeout(function(){
								plus.nativeUI.closeWaiting(); 
							},10000);
			}
			function init(param){
				$("#exchangeNo").val(param[3]);
				$("#commodeityNo").val(param[2]);
				$("#contractNo").val(param[1]);
				$("#contractSize").val(param[5]);
				$("#lastPrice").text(param[7]);
//				$("#lastPriceNone").val(param[7]);
				$("#miniTikeSize").val(param[6]);
				$("#doSize").val(param[4]);
			}
			function cachTranFers(param){
				tranferParam = param;
			}
			var loginOutFlag = false;
			$(function(){ 
				$('#password').bind('input propertychange', function() {
				  	var orderPrice = $("#orderPrice").val();
				  	$("#buyBtn_P").val(orderPrice);
				  	$("#sellBtn_P").val(orderPrice);
				});
				$("#switchAccount").click(function(){
					if(username != null){
						alertProtype("是否切换当前账号","提示",Btn.confirmedAndCancle(),switchAccount,null,null);
					}else{
						openLogin();
					}
				});
				$("input[type='radio']").click(function(){
					var type = $("input[type = 'radio']:checked").val();
					var orderPrice = $("#orderPrice");
					var lastPrice = $("#lastPrice").text();
					var miniTikeSize = $("#miniTikeSize").val();
					var doSize = $("#doSize").val();
					if(type == 1){  
						$("#buyBtn_P").text(parseFloat(doGetMarketPrice(lastPrice,miniTikeSize,0)).toFixed(doSize));
						$("#sellBtn_P").text(parseFloat(doGetMarketPrice(lastPrice,miniTikeSize,1)).toFixed(doSize));
						orderPrice.prop("placeholder","市价");
						orderPrice.prop("value",""); 
						orderPrice.prop("disabled",true);
					}else{
						orderPrice.prop("disabled",false);
						orderPrice.prop("value",lastPrice); 
						$("#buyBtn_P").text(lastPrice);
						$("#sellBtn_P").text(lastPrice);
						orderPrice.prop("placeholder","");
					}
				});
				if(username == null){
					$("#switchAccount").text("登录账号");
				}
				//提交订单
				$(".buy").click(function(){
					if(vadationIsLogin()){
						var orderNumber = $("#orderNumber").val();
						if(orderNumber <= 0){
							mui.toast("请输入正确的手数");
							return;
						}
						if(orderNumber > 200){
							mui.toast("最多只能输入200手");
							return;
						}
						var priceType = $("input[type='radio']:checked").val();
						var orderPrice = $("#orderPrice").val();
						var tradeDrection = $(this).attr("data-tion-buy"); 
						if(priceType == 0){
							if(orderPrice <= 0 || orderPrice.length <= 0){
								mui.toast("请输入正确的价格");
								return;
							}
						}else if(priceType == 1){
							orderPrice = doGetMarketPrice($("#lastPrice").text(),$("#miniTikeSize").val(),tradeDrection);
						}
						var commodeityNo = $("#commodeityNo").val();
						var contractNo = $("#contractNo").val();
						var content = "确定提交订单："+commodeityNo+contractNo+",价格("+orderPrice+"),手数("+orderNumber+")";
						alertProtype(content,"确认下单?",Btn.confirmedAndCancle(),doInsertOrder,null,$(this));
					}
				});
				$("#allOpen").click(function(){
					var allOpen = $(".PositionLi");
					if(allOpen.length <= 1){
						mui.toast("没有持仓合约");
						return;
					}
					if(vadationIsLogin()){
						var content = "合约是否全部平仓?";
						alertProtype(content,"确认下单吗?",Btn.confirmedAndCancle(),doInsertAllSellingOrder);
					}
				});
				$("#Open").click(function(){
					if(positionWholeContract == null){
						mui.toast("请选择需要平仓的合约");
						return;
					}
					if(vadationIsLogin()){
						var content = "当前合约是否平仓?";
						alertProtype(content,"确认下单吗?",Btn.confirmedAndCancle(),doInsertSellingOrder);
					}
				});
				$("#kilAnorder").click(function(){
					if(designateWholeContracts == null){
						mui.toast("请选择需要撤单的订单");
						return;
					}
					if(vadationIsLogin()){
						var content = "您是否真的要进行撤单操作?";
						alertProtype(content,"确认撤单?",Btn.confirmedAndCancle(),doInsertCancleOrder);
					}
				});
				$(".marketBuy").click(function(){
					if(vadationIsLogin()){
						var $this = $(this);
						var lastPrice = $("#freshPrices").text();
						if(lastPrice <= 0 || lastPrice == undefined || lastPrice == null || isNaN(lastPrice)){
							alertProtype("交易错误","提示",Btn.confirmed());
							return;
						}
						var commodityNo = $("#commodeityNo").val();
						var contractNo = $("#contractNo").val();
						var orderNum = $("#orderNum").val();
						var miniTikeSize = $("#miniTikeSize").val();
						var orderNum = $("#orderNum").val();
						if(orderNum <= 0 ){
							mui.toast("请输入正确的手数"); 
							return;
						}
						if(orderNum > 200){
							mui.toast("最多只能输入200手"); 
							return;
						}
						var drection = $this.attr("data-tion-buy");
						var limitPrice = doGetMarketPrice(lastPrice,miniTikeSize,drection);
						var content = "确定提交订单："+commodityNo+contractNo+",价格("+limitPrice+"),手数("+orderNum+")";
						var isFlag = alertProtype(content,"确认下单?",Btn.confirmedAndCancle(),buy,null,$this);
					}
				});
			});
			function switchAccount(){
				clearLogin();
				$("#switchAccount").text("登录账户");
				openLogin();
			}
			function vadationIsLogin(){
				if(username == null){
						alertProtype("你还未登录,请先登录","提示",Btn.confirmedAndCancle(),openLogin,alertCallBack);
						return false;
				}
				return true;
			}
			function openLogin(){
				mui.openWindow({
					url:"../login/operateLogin.html",
					id : "operateLogin",
					 extras:{
								commdityNo:$("#commodeityNo").val(),
								name : tranferParam,
								backpageID:"transactionDetails"
							}
				});
			};
			function alertCallBack(){
				if($("#TradingCenter").hasClass("mui-active")==true){
					$("#TradingCenter").removeClass(" mui-active");
					$("#trade").removeClass(" mui-active");
					if($("#CandlestickChart").hasClass("mui-active")==true){
						$("#Candlestick").addClass(" mui-active");
						$("#CandlestickChart").addClass(" mui-active");
							
					}else if($("#TimeChart1").hasClass("mui-active")==true){
						$("#TimeChart1").addClass(" mui-active");
						$("#Time").addClass(" mui-active");
					}else if($("#dayCandlestickChart").hasClass("mui-active")==true){
						$("#dayCandlestickChart").addClass(" mui-active");
						$("#dayCandlestickBtn").addClass(" mui-active");
					}
				}else{
//					console.log("错误")
				}
			}
			/**
			 * 下单操作 
			 */
			function doInsertOrder(param){
				if(validationLastPrice()){
					alertProtype("交易错误","提示",Btn.confirmed());
					return;
				}
				var $this = param;
				var tradeDrection = $this.attr("data-tion-buy");
				var orderNumber = $("#orderNumber").val();
				var orderPrice = $("#orderPrice").val();
				var priceType = $("input[type='radio']:checked").val();
				
				if(orderNumber == null || isNaN(orderNumber) || orderNumber <= 0 || orderNumber.length <= 0){
					alertProtype("手数输入错误数量","提示",Btn.confirmed());
					return;
				}
				if(priceType == 1){
					orderPrice = doGetMarketPrice($("#lastPrice").text(),$("#miniTikeSize").val(),tradeDrection);
				}
				if(orderPrice == null || isNaN(orderNumber) || orderPrice <= 0 || orderPrice.length <= 0 ){
					alertProtype("价格输入错误","提示",Btn.confirmed());
					return;
				}
				var exchanageNo = $("#exchangeNo").val();
				var commodeityNo = $("#commodeityNo").val();
				var contractNo = $("#contractNo").val();
				Trade.doInsertOrder(exchanageNo,commodeityNo,contractNo,orderNumber,tradeDrection,0,orderPrice,0,doGetOrderRef());
				plus.nativeUI.showWaiting();
				setTimeOutInsertOrder(); 
			}
			/**
			 * 全部平仓操作 
			 */
			function doInsertAllSellingOrder(){
				for (var i = 0 ; i < positionsIndex ; i++) {
					var contractParam = new Array();
					//验证该平仓数据是否存在列表中
					if($(".position-index"+i+"").html() == undefined){
						continue;
					}
					var contract = positionContractCode[i];
					contractParam[0] = contract;
					var tradeParam = doGetTradeBasicParam(contractParam);
					selling(tradeParam);
				}
				plus.nativeUI.showWaiting();
				setTimeOutInsertOrder();
				positionWholeContract = null;
				positionWholeIndex = 0;
			}
			/**
			 * 平仓操作 
			 */
			function doInsertSellingOrder(){
				var positonDom = $(".position-index"+positionWholeIndex+"");
				//验证该平仓数据是否存在列表中
				if(positonDom.html() == undefined){
					alertProtype("交易错误","提示",Btn.confirmed());
					return;
				}
				var contractParam = new Array();
				contractParam[0] = positionWholeContract;
				var tradeParam = doGetTradeBasicParam(contractParam);
				selling(tradeParam);
				positionWholeContract = null;
				positionWholeIndex = 0;
				plus.nativeUI.showWaiting();
				setTimeOutInsertOrder();
			}
			/**
			 * 撤单确认操作 
			 */
			function doInsertCancleOrder(){
				var lengthIndex= designatesOrderId.length;
				var contractParam = new Array();
				for(var i = 0 ; i < lengthIndex ; i++){
					var orderId = designatesOrderId[i];
					var designateDom  = $("li[data-tion-designates='"+orderId+"']");
					if(designateDom.html() == undefined){
						return;
					}
					contractParam[0] = orderId;
					cancleOrderId = orderId;
				}
				var cancleParam = doGetCancelOrderBasicParam(contractParam);
				cancleOrder(cancleParam);
				designateWholeContracts = null;
				designateWholeIndex = 0;
				plus.nativeUI.showWaiting();
				setTimeOutInsertOrder();
			}
			/**
			 * 获取平仓的基本信息 
			 * @param {Object} param
			 */
			function doGetTradeBasicParam(param){
				var tradeParam = new Array();
				var length = param.length;
				for(var i = 0 ; i < length ; i++){
					var contract = param[i];
					var $contractCode  = $("li[contract-code-position='"+contract+"'] span[class = 'position0']").text();
					var $drection =  $("li[contract-code-position='"+contract+"'] span[class = 'position1']").attr("data-drection");
					var $holdNum =  $("li[contract-code-position='"+contract+"'] span[class = 'position2']").text();
					var $openAvgPrice =  $("li[contract-code-position='"+contract+"'] span[class = 'position3']").text();
					var $floatingProfit =  $("li[contract-code-position='"+contract+"'] span[class = 'position4']").text();
					var $commodityNo =  $("li[contract-code-position='"+contract+"'] span[class = 'position5']").text();
					var $contractNo =  $("li[contract-code-position='"+contract+"'] span[class = 'position6']").text();
					var $exchangeNo =  $("li[contract-code-position='"+contract+"'] span[class = 'position7']").text();
					var drection = 0;
					if($drection == 0){
						drection = 1;	
					}
					if(validationLastPrice()){
						alertProtype("金额错误","提示",Btn.confirmed());
						return;
					} 
					var lastPrice = marketCommdityLastPrice[$commodityNo+$contractNo];
					var comm = marketCommdity[$commodityNo+$contractNo];
					if(comm == undefined)continue;
					var limitPirce = doGetMarketPrice(lastPrice,comm.MiniTikeSize,drection);
					var sellingParam = createSellingParam($exchangeNo,$commodityNo,$contractNo,$holdNum,drection,0,Math.abs(limitPirce),0,doGetOrderRef());
					tradeParam[i] = sellingParam;
				}
				return tradeParam;
			}
			function doGetCancelOrderBasicParam(param){
				var cancleParam = new Array();
				var length = param.length;		
				for(var i = 0 ; i < length ; i++){
					var contract = param[i];
					var $contractCode  = $("li[data-tion-designates='"+contract+"'] span[class = 'desig0']").text();
					var $drection =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig1']").attr("data-drection");
					var $orderPrice =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig2']").text();
					var $orderNum =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig3']").text();
					var $cdNum =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig4']").text();
					var $InsertDateTime =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig5']").text();
					var $OrderSysID =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig6']").text();
					var $commodityNo =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig7']").text();
					var $contractNo =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig8']").text();
					var $exchangeNo =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig9']").text();
					var $orderId =  $("li[data-tion-designates='"+contract+"'] span[class = 'desig10']").text();
					var cancleOrderParam = createCancleOrderParam($OrderSysID,$orderId,$exchangeNo,$commodityNo,$contractNo,$orderNum,$drection,Math.abs($orderPrice));
					cancleParam[i] = cancleOrderParam; 
				}
				return cancleParam;
			}
	function buy(param){
		var $this = param;
		var lastPrice = $("#freshPrices").text();
		if(lastPrice <= 0 || lastPrice == undefined || lastPrice == null || isNaN(lastPrice)){
			alertProtype("交易错误","提示",Btn.confirmed());
			return;
		}
		var exchangeNo = $("#exchangeNo").val();
		var commodityNo = $("#commodeityNo").val();
		var contractNo = $("#contractNo").val();
		var contractSize = $("#contractSize").val();
		var miniTikeSize = $("#miniTikeSize").val();
		var orderNum = $("#orderNum").val();
		var drection = $this.attr("data-tion-buy");
		var limitPrice = doGetMarketPrice(lastPrice,miniTikeSize,drection);
		var priceType = 0;
		var tradeParam = createSellingParam(exchangeNo,commodityNo,contractNo,orderNum,drection,priceType,limitPrice,0,doGetOrderRef());
		var param = new Array();
		param[0] = tradeParam;
		selling(param);
	}

			/**
			 * 验证最新价格 
			 */
			function validationLastPrice(){
				var lastPrice = $("#lastPrice").text();
				if(lastPrice == undefined || lastPrice == null || lastPrice.length == 0 || parseFloat(lastPrice) <= 0){
					return true;
				}else{
					return false;
				}
			}
		
	</script>

	</body>

</html>
