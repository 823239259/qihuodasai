<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>我要充值</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/own.css" />
	</head>

	<body>
		<style>
			.mui-control-content {
				background-color: white;
			}
			/*@media screen and (max-height: 480px ) {
			.mui-control-content { min-height: 370px;}
		}
		@media screen and (min-height: 481px) and (max-height: 568px) {
			.mui-control-content { min-height: 460px;}
		}
		@media screen and (min-height: 569px) and (max-height: 667px) {
			.mui-control-content { min-height: 560px;}
		}
		@media screen and (min-height: 568px) and (max-height: 720px) {
			.mui-control-content { min-height: 600px;}
		}*/
			
			.mui-control-content .mui-loading {
				margin-top: 50px;
			}
		</style>
		<header class="mui-bar mui-bar-nav own-topbg">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" id="back"><i>返回</i></a>
			<h1 class="mui-title">我要充值</h1>
			<a href="javascript:void(0)" class="top-tel" id="telBtn">客服热线</a>
		</header>
		<!--<nav class="navlist">
		<a href="javascript:void(0);" id="product">
			<span class="mui-icon mui-icon-list"></span>
			<span class="mui-tab-label">产品</span>
		</a>
		<a class="" href="javascript:void(0);"  id="scheme">
			<span class="mui-icon mui-icon-compose"></span>
			<span class="mui-tab-label">方案</span>
		</a>
		<a  class="navon"  id="account" href="javascript:void(0);">
			<span class="mui-icon mui-icon-contact mui-icon-icon-contact-filled"></span>
			<span class="mui-tab-label" >账户</span>
		</a>
	</nav>-->
		<div class="mui-content ac_charge">
			<div id="slider" class="mui-slider">
				<div id="segmentedControl" class="mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<!--<a class="mui-control-item mui-active" id="onlinePay">在线网银</a>-->
					<!--<a class="mui-control-item" id="alipay">支付宝转账</a>-->
					<a class="mui-control-item" id="alipayApp">充值</a>
					<a class="mui-control-item" id="bankPay">银行转账</a>
				</div>
				<div id="sliderProgressBar" class="mui-slider-progress-bar mui-col-xs-6"></div>
				<div class="mui-slider-group" id="itembox">
					<div id="item6mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="" class="mui-scroll-wrapper ac_online">
							<ul class="mui-table-view">
								<li class="mui-table-view-cell">
									<label>账户余额</label>
									<span id="balanceSpan">0.00元</span>
								</li>
								<li class="mui-table-view-cell">
									<label>充值金额</label>
									<span>元</span>
									<input type="tel" id="rechargeMoneyAlipayApp" class="mui-input-clear" placeholder="输入金额" data-input-clear="5">
								</li>
							</ul>
							<div class="mui-content-padded" style="margin-top: -15px;">
								<p>1.单笔充值最多5万元(含5万)，单日充值最多10万元(不含10万)；</p>
								<p>2.具体充值限额以您的银行卡快捷支付限额为准。</p>
							</div>
							<!--<ul class="mui-table-view">
								<li class="mui-table-view-cell">
									<label>支付渠道</label>
									<img src="../../images/ac_bank.gif" class="ac_bankpic" />
								</li>
							</ul>-->
							<div class="ac_btn">
								<button type="button" id="alipayapp-btn" class="mui-btn mui-btn-block lg-btnlogin">立即充值</button>
							</div>
						</div>
					</div>
					<!--<div id="item1mobile" class="mui-slider-item mui-control-content mui-active">
						<div id="" class="mui-scroll-wrapper ac_online">
							<ul class="mui-table-view">
								<li class="mui-table-view-cell">
									<label>账户余额</label>
									<span id="balanceSpan">0.00元</span>
								</li>
								<li class="mui-table-view-cell">
									<label>充值金额</label>
									<span>元</span>
									<input type="tel" id="rechargeMoney" class="mui-input-clear" placeholder="输入金额" data-input-clear="5">
								</li>
							</ul>
							<div class="mui-content-padded" style="margin-top: -15px;">
								<p>1.单笔充值最多5万元(含5万)，单日充值最多10万元(不含10万)；</p>
								<p>2.具体充值限额以您的银行卡快捷支付限额为准。</p>
							</div>
							<ul class="mui-table-view">
								<li class="mui-table-view-cell">
									<label>支付渠道</label>
									<img src="../../images/ac_bank.gif" class="ac_bankpic" />
								</li>
							</ul>
							<div class="ac_btn">
								<button type="button" id="recharge-btn" class="mui-btn mui-btn-block lg-btnlogin">立即充值</button>
							</div>
						</div>
					</div>-->

					<!--<div id="item2mobile" class="mui-slider-item mui-control-content ac_alipay">
						<div id="" class="mui-scroll-wrapper ac_online">
							<div class="mui-scroll">
								<ul id="list" class="mui-table-view mui-table-view-chevron">
								<li class="mui-table-view-cell">
									<a class="mui-navigate-right" id="bindAlipay">
										<label>绑定支付宝账号</label>
										<b><span id="alipay_account">待绑定</span></b>
									</a>
								</li>
							</ul>
								<ul class="mui-table-view">
									<li class="mui-table-view-cell">
										<label>收款人支付宝账户</label>
										<span>zhitoubao@126.com</span>
									</li>
									<li class="mui-table-view-cell">
										<label>收款人账户名称</label>
										<span>上海信闳投资管理有限公司</span>
									</li>
								</ul>
								<div class="ac_btn">
									<a href="javascript:void(0);" id="openappliy" class="mui-btn mui-btn-block lg-btnlogin">打开支付宝</a>
								</div>
								<div class="mui-content-padded">
									<h5>温馨提示：</h5>
									<p>1、若在该页面打开支付宝失败，您可以手动启动支付宝APP或者登录支付宝官网，选择转账到支付宝账户，手工输入信闳投资的收款支付宝账户，最终完成转账。</p>
									<p>2、最快5分钟内到账，最晚下一个工作日09:15前到账。</p>
								</div>
							</div>
						</div>
					</div>-->
					<div id="item3mobile" class="mui-slider-item mui-control-content ac_bank">
						<div id="" class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<li class="mui-table-view-cell">
										<label>转入银行</label>
										<select class="mui-btn mui-btn-block" id="abbreviation">
											<option value="-1">请选择您的转账银行</option>
											<option value="ccb">中国建设银行</option>
											<option value="icbc">中国工商银行</option>
											<option value="abc">中国农业银行</option>
											<option value="boc">中国银行</option>
										</select>
									</li>
									<li class="mui-table-view-cell">
										<label>转账金额</label>
										<input type="number" class="mui-input-clear" placeholder="" data-input-clear="5" id="bank_money">
									</li>
									<li class="mui-table-view-cell">
										<label>流水单号</label>
										<input type="text" class="mui-input-clear" placeholder="" data-input-clear="5" id="serialnum">
									</li>
								</ul>
								<div class="ac_banklist" style="margin-top: 20px">
									<img src="../../images/bank_01.gif" />
									<p>账号：3100 1518 0000 5003 1146<br>户名：上海信闳投资管理有限公司<br>开户行：中国建设银行上海黄浦支行</p>
								</div>
								<div class="ac_banklist">
									<img src="../../images/bank_02.gif" />
									<p>账号：1001 2689 1901 6802 706<br>户名：上海信闳投资管理有限公司<br>开户行：中国工商银行上海金陵东路支行</p>
								</div>
								<div class="ac_banklist">
									<img src="../../images/bank_03.gif" />
									<p>账号：0335 7100 0400 11335<br>户名：上海信闳投资管理有限公司<br>开户行：中国农业银行上海西藏南路支行</p>
								</div>
								<div class="ac_banklist">
									<img src="../../images/bank_04.gif" />
									<p>账号：4572 6756 9167<br>户名：上海信闳投资管理有限公司<br>开户行：中国银行上海大世界支行</p>
								</div>
								<p class="ac_bankpromt">向维胜转账后，请录入流水单号，方便及时核实到账</p>
								<div class="ac_btn">
									<button id="openbankPay" class="mui-btn mui-btn-block lg-btnlogin" type="button">确认提交</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script type="text/javascript" src="../../js/jquery-1.11.3.js"></script>
		<script type="text/javascript" src="../../js/pingpp.js"></script>
		<script>
			var item = document.getElementById('itembox');
			var scheight = document.documentElement.clientHeight;
			var infoheihgt = scheight - 44 - 57;
			item.style.height = infoheihgt + 'px';
			alipayApp.addEventListener("tap", function() {
				$("#sliderProgressBar").css({"transform":"translate3d(0px, 0px, 0px) translateZ(0px)"})
				$("#item6mobile").addClass("mui-active");
				$("#item3mobile").removeClass("mui-active");
		$("#itembox").css({"-webkit-transform": "translate3d(0px, 0px, 0px) translateZ(0px)", "-webkit-transition": "0ms cubic-bezier(0.165, 0.84, 0.44, 1)","transition": "0ms cubic-bezier(0.165, 0.84, 0.44, 1)"});
			});
			bankPay.addEventListener("tap", function() {
				$("#sliderProgressBar").css({"transform":"translate3d(0px, 0px, 0px) translateZ(0px)"})
				$("#item3mobile").addClass("mui-active");
				$("#item6mobile").removeClass("mui-active");
				$("#itembox").css({"-webkit-transform": "translate3d(-100%, 0px, 0px) translateZ(0px)"," -webkit-transition": "0ms cubic-bezier(0.165, 0.84, 0.44, 1)", "transition": "0ms cubic-bezier(0.165, 0.84, 0.44, 1)"});
			});
			/*mui.init({

		    swipeBack: false, 
		    subpages:[{
		      url:'../commonback.html',
		      id:'common.html',
		      styles:{
		        top:'0px',//mui标题栏默认高度为45px；
		      }
		    }]
		  });*/
			mui.init({
				swipeBack: false,

				gestureConfig: {
					tap: true, //默认为true
					drag: true, //默认为true
				}
			});
			var payPage = null; //定义币币支付页面对象变量
			var win = null;
			var pay_id = null;
			var pays = {};
			mui.plusReady(function() {
			//var thisURL = document.URL;
			//alert(thisURL);
			
			  var wv = plus.webview.currentWebview();
              var vText = wv.money;//这样就能接收到上个页面传过来的值了
              var balance = parseFloat(document.getElementById("balanceSpan").innerHTML);
              var vTextlength = vText.length;
              var cb = vText.substring(0,vTextlength - 1);
              var chargeBalance = cb.replace(",","");
              var chargeAmount = chargeBalance - balance; 
              document.getElementById("rechargeMoneyAlipayApp").value = chargeAmount;
			  /*document.getElementById("openappliy").addEventListener("tap", function() {
					plus.runtime.openURL("https://qr.alipay.com/apw1hz7ddal8e7zsfe");
				});*/
				document.getElementById("alipayapp-btn").addEventListener("tap", function() {
					/*mui.app_request('/user/pay/pingplusplus', {
						"money": 1,
						"payWay":4
					}, 
					function(result) {
					},
					function(result) {
						var charge = JSON.parse(result);
						pingpp.createPayment(charge, function(result, err) {
							if(result == "success") {
								// 只有微信公众账号 wx_pub 支付成功的结果会在这里返回，其他的支付结果都会跳转到 extra 中对应的 URL。
							} else if(result == "fail") {
								// charge 不正确或者微信公众账号支付失败时会在此处返回
							} else if(result == "cancel") {
								// 微信公众账号支付取消支付
							}
						});
					}
					);*/
					var money = document.getElementById("rechargeMoneyAlipayApp").value;
					var w = plus.webview.create("http://hedaoqing.oicp.net/tzdr-app-web/tzdr/account/openUrlPay.html","pay",{top:"45px"},{money:money});
					w.show();
				});
				/*switch(plus.os.name) { //根据客户端修改充值文本框属性
					case "Android":
						document.getElementById("rechargeMoney").setAttribute('type', 'tel');
						break;
					case "iOS":
						document.getElementById("rechargeMoney").setAttribute('type', 'number');
						break;
					default:
						document.getElementById("rechargeMoney").setAttribute('type', 'number');
						break;
				}*/

				//获取网银充值账户余额信息
				mui.app_request('/user/getbalancerate', {
						'businessType': 3
					},
					function(result) {
						var balance = result.data.balance;
						document.getElementById("balanceSpan").innerHTML = balance + '元';
						return;
					},
					function(result) {
						return;
					}
				);

				tzdr.init.initHearListener();
				//tzdr.init.initButtomListener();

				/*document.getElementById("telBtn").addEventListener("tap",function(){
    			mui.callService();
    		});
    		document.getElementById("back").addEventListener("tap",function(){
    			history.back();
    		});*/

				/*document.getElementById("onlinePay").addEventListener("tap", function() {
					document.getElementById("onlinePay").href = "#item1mobile";
				});

				document.getElementById("alipay").addEventListener("tap", function() {
					document.getElementById("alipay").href = "#item2mobile";
			});*/	
				document.getElementById("alipayApp").addEventListener("tap", function() {
					document.getElementById("alipayApp").href = "#item1mobile";
				});
				document.getElementById("bankPay").addEventListener("tap", function() {
					document.getElementById("bankPay").href = "#item3mobile";
				});

				//添加充值金额文本框监听
				document.getElementById("alipayapp-btn").addEventListener('input', function() {
					if(this.value && !Number(this.value)) { //非数字赋值空
						var _length = this.value.length;
						moneyHandle(this.value.substr(0, _length - 1), this); //删除非金额字符
						return;
					} else {
						var _length = this.value.length;
						var _index = this.value.lastIndexOf('.');
						var _temp_value = _index > 0 ? this.value.substr(_index + 1, _length) : '';
						this.value = _temp_value.length > 2 ? this.value.substr(0, _length - 1) : this.value;
						return;
					}
				});

				/*//网银充值“立即充值”操作
				document.getElementById("recharge-btn").addEventListener("tap", function() {
					var money = document.getElementById("rechargeMoney").value;
					if(mui.isnull(money)) {
						mui.toast("充值金额不能为空");
						return;
					}
					//充值"操作"
					mui.app_request('/user/pay/ebankrecharge', {
						"money": money
					}, function(result) {
						var payParams = {
							"payurl": result.data.payurl,
							"vamount": result.data.vamount,
							"vmd5info": result.data.vmd5info,
							"vmid": result.data.vmid,
							"vmoneytype": result.data.vmoneytype,
							"vordername": result.data.vordername,
							"vorderstatus": result.data.vorderstatus,
							"vorid": result.data.vorid,
							"vpmode": result.data.vpmode,
							"vrcvaddr": result.data.vrcvaddr,
							"vrcvname": result.data.vrcvname,
							"vrcvpost": result.data.vrcvpost,
							"vrcvtel": result.data.vrcvtel,
							"vurl": result.data.vurl,
							"vymd": result.data.vymd
						};
						//var payParams ={mobilePayUrl:result.data.mobilePayUrl,merchantaccount:result.data.merchantaccount,data:result.data.data,encryptkey:result.data.encryptkey};
						payPage = plus.webview.create('pay.html', 'pay.html', {}, payParams)
						plus.webview.show(payPage);
						return;
					}, function(result) {
						if(result.code == 2) {
							mui.toast("充值金额不能为空！");
							return;
						} else if(result.code == 3) {
							mui.toast("充值金额必须大于或等于1、小于或等于5000000！");
							return;
						} else if(result.code == 4) {
							mui.toast("在线网银每天限额10万元，超额部分请选择其他方式充值！");
							return;
						} else {
							mui.toast("系统繁忙，请稍后再试！");
							return;
						}
					});
				});*/

				/*//获取支付宝账号
				getalipayAcount();*/

				/*document.getElementById("bindAlipay").addEventListener("tap", function() {
					var alipay_account = document.getElementById("alipay_account");
					mui.prompt("请输入要绑定的支付宝账号", "支付宝账号", "绑定提示", ['取消', '绑定'], function(e) {
						if(e.index == 0) {
							return;
						}
						if(mui.isnull(e.value)) {
							mui.toast("支付宝账号不能为空");
							return;
						}
						mui.app_request('/user/pay/bindalipay', {
							"alipayAcount": e.value
						}, function(result) {
							mui.toast("绑定成功！");
							alipay_account.innerHTML = e.value;
							return;
						}, function(result) {
							if(result.code == 2) {
								mui.toast("支付宝账号已经存在！");
								return;
							} else if(result.code == 3) {
								mui.toast("支付宝账号不能为空！");
								return;
							} else {
								mui.toast("系统繁忙，请稍后再试！");
								return;
							}
						})
					});

				});*/

				/*	document.getElementById("openAlipay").addEventListener("tap",function(){
				mui.openWindow("alipy://");
    			
    		});*/

				document.getElementById("openbankPay").addEventListener("tap", function() {
					banksPay();
				});

			});

			//金额处理方法【_value：金额(如果包含非金额字符，递归到删除非金额字符)，_obj输入框对象】
			function moneyHandle(_value, _obj) {
				if(_value && !Number(_value)) { //非数字赋值空
					var _length = _value.length;
					moneyHandle(_value.substr(0, _length - 1), _obj);
				} else {
					_obj.value = _value
					return;
				}
			}

			function banksPay() {
				var abbreviation = document.getElementById("abbreviation").value;
				var bank_money = document.getElementById("bank_money").value;
				var serialnum = document.getElementById("serialnum").value;
				if(abbreviation == -1) {
					mui.toast("请选择您转账的银行");
					return;
				}
				if(mui.isnull(bank_money)) {
					mui.toast("转账的金额不能为空且不能输入非法字符！");
					return;
				}
				if(!tzdr.moneyUtils.testDecimal(bank_money)) {
					mui.toast("转账金额只能输入小数点后两位！");
					document.getElementById("bank_money").value = "";
					return;
				}

				if(mui.isnull(serialnum)) {
					mui.toast("请输入转账流水单号");
					return;
				}
				mui.app_request('/user/pay/bank_transfer', {
					"abbreviation": abbreviation,
					"serialnum": serialnum,
					"money": bank_money
				}, function(result) {
					mui.toast("提交成功，我们会尽快核实处理！");
					mui.app_refresh("account");
					return;
				}, function(result) {
					if(result.code == 2) {
						mui.toast("提交失败，参数有误！");
						return;
					} else if(result.code == 3) {
						mui.toast("用户信息不存在！");
						return;
					} else if(result.code == 4) {
						mui.toast("充值金额不能小于1元！");
						return;
					} else {
						mui.toast("系统繁忙，请稍后再试！");
						return;
					}
				})
			}

			/*function getalipayAcount() {
				mui.app_request("/user/pay/getalipayacount", {}, function(result) {
					if(mui.isnull(result.data.alipayAcount)) {
						document.getElementById("alipay_account").innerHTML = "待绑定";
						return;
					}
					document.getElementById("alipay_account").innerHTML = result.data.alipayAcount;
					return;
				}, function(result) {

					document.getElementById("alipay_account").innerHTML = "待绑定";
					return;
				})
			};*/

			(function($) {
				$('.mui-scroll-wrapper').scroll({
					indicators: true //是否显示滚动条
				});
				var sliderSegmentedControl = document.getElementById('sliderSegmentedControl');
			})(mui);
		</script> 
	</body>

</html>