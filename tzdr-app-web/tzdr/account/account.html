<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>我的账户</title>
    <script type="text/javascript" src="../../js/mui.min.js"></script> 
    <script type="text/javascript" src="../../js/common.js"></script>
    <link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
    <link rel="stylesheet" href="../../css/own.css" />
    <script src="../../js/jquery-1.11.3.js"></script>
    <script type="text/javascript" charset="UTF-8">
      	mui.init({

		  });
		 
      	var win=null;
      	var title_name=null;
      	var title_balance=null;
      	var user_mobile=null;
      	var Certification=null;
      	mui.plusReady(function(){
      		win=plus.webview.currentWebview();
			//判断token和密钥是否存在,存在则获取用户信息
				title_name=document.getElementById("title_name");
      			title_balance=document.getElementById("title_balance");
      			Certification=document.getElementById("Certification");
      			user_mobile=plus.storage.getItem("user_mobile");
      		//对登录状态判断
      		if(mui.cacheUser.isLogin()){ 
      			var paramUrl={
					url:"../login/login.html"
				}
      			//获取用户信息 
      			mui.app_request('/user/getbalancerate',{
      				"businessType":4 
      			},function(result){
      					console.log(JSON.stringify(result));
      					if(!mui.isnull(result.data.username)){
      						title_name.innerHTML="欢迎您，"+result.data.username+":";
      					}else if(!mui.isnull(user_mobile)){
      						user_mobile=user_mobile.substring(0,3)+"****"+user_mobile.substring(7,11);
      						title_name.innerHTML="欢迎您，"+user_mobile+":";
      					}
      					if(!mui.isnull(result.data.balance)){
      						title_balance.innerHTML=result.data.balance+"元";
      					}else{
      						title_balance.innerHTML="0.00元";
      					}
      					if(result.data.isCertification){
      						Certification.innerText="已认证";
      						Certification.style.color = 'green';
      					}else{
      						Certification.innerText="未认证";
      						Certification.style.color = '#888888';
      					}
      					if(result.data.wxAccount==null){
      						$("#weixin b").text("未关注");
      					}else{
      						$("#weixin b").text("已关注")
      					}
      					return;
      				},function(result){
      					return;
      			},paramUrl);
      		}else{
      			title_name.innerHTML="请您先登录";
      			title_balance.innerHTML="0.00元";
      		}
      		var dataUrl={
  				home:"../../home.html",
  				account:"account.html",
  				accountno:"tzdr/account/accountno.html",
  				scheme:"../scheme.html",
  				listrg:"../future/listrg.html",
  				quotationMain:"../quotation/quotationMain.html",
  			}
      		
      		
			//初始化监听头部和底部事件
			tzdr.init.initHearListener();
  			initBottom(dataUrl);
    		document.getElementById("charge").addEventListener("tap",function(){
    			mui.openWindow({
    				url:"recharge.html",
    				id:"recharge.html",
    				extras:{
    					 backId:"account"
    				}
    			});
    		});
    		
    		document.getElementById("withdraw").addEventListener("tap",function(){
    				mui.openWindow("withdraw.html","withdraw");
    		});
    		
    	/*	document.getElementById("quit").addEventListener("tap",function(){
    			mui.cacheUser.clear();
    			// 清除缓存页面
				mui.cacheUser.clearCachePages();
    			mui.openWindow("../login/login.html");
    		});*/
    		 
    		document.getElementById("user_verified").addEventListener("tap",function(){
    			if("已认证"==Certification.innerText){
    				return;
    			}else{
    				mui.openWindow({url:"verified.html",id:"verified",extras:{backPage:'account'}});
    			}
    		});
    		
    		document.getElementById("funddetail").addEventListener("tap",function(){
    			mui.openWindow("fundDetail.html","fundDetail");
    		});
    		
    		document.getElementById("coupon").addEventListener("tap",function(){
    			mui.openWindow("coupon.html","coupon"); 
    		});
    		
    		document.getElementById("telPhone").addEventListener("tap",function(){
    			mui.app_refresh("telphone");
    			mui.openWindow("telphone.html",'telphone');
    		});
    		document.getElementById("weixin").addEventListener("tap",function(){
    			if($("#weixin b").text()=="已关注"){
    				mui.toast("你已关注过啦~");
    				return;
    			}
    			$("#weixinCodeImage").css({"display":"block"});
    			chechCode();
//  			mui.openWindow({
//					url:"bindWeixin.html",
//					id:"bindWeixin"
//				});
    		});
    		document.getElementById("weixinCodeImage").addEventListener("tap",function(){
    			mui.app_refresh("account");
    			$("#weixinCodeImage").css({"display":"none"});
    		})
    		document.getElementById("updatepw").addEventListener("tap",function(){
    			mui.app_refresh("updatePW");
    			mui.openWindow("updatePW.html","updatePW");
    		});
    	
    		// 监听确定退出事件
	    	mui('body').on('tap', '.mui-popover-action li>a', function() {
				var a = this,
					parent;
				//根据点击按钮，反推当前是哪个actionsheet
				for (parent = a.parentNode; parent != document.body; parent = parent.parentNode) {
					if (parent.classList.contains('mui-popover-action')) {
						break;
					}
				}
				// 确认退出
				var aid = a.id;
				if ('confirm_quit'==aid){
					mui.cacheUser.clear();
    				// 清除缓存页面    
					//mui.cacheUser.clearCachePages();
	    			mui.openWindow({url:"../login/login.html",id:"login",extras:{backpageID:"account"}});  
				}
				//关闭actionsheet
				mui('#' + parent.id).popover('toggle');   
				//alert(a.id);  
			});
			function chechCode(){
				mui.app_request("/wechat/getWechatQrcodeTicket",{},function(res){
					if(res.success){
						document.getElementById("weixinCodeImg").src=res.data.url+"?ticket="+res.data.ticket;
					}else{
						mui.toast("重新加载")
					}
				},function(res){
				})
			}
      	});
      	
    </script>
</head>
<body>
	<header class="mui-bar mui-bar-nav own-topbg">
		<!--<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" id="back"><i>返回</i></a>-->
		<h1 class="mui-title">我的账户</h1>		
		<a href="javascript:void(0)" class="top-tel" id="telBtn">客服热线</a>
	</header>	
	<nav class="navlist">
		<a class="" href="javascript:void(0);" id="quotationMain" >
			<!--<span class="mui-icon mui-icon-settings"></span>-->
			<span class="mui-icon"><img src="../../images/0.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label">行情交易</span>
		</a>
		<a class="" href="javascript:void(0);"  id="product">
			<span class="mui-icon"><img src="../../images/1.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label">操盘申请</span>
		</a>
		<a class="" href="javascript:void(0);"  id="scheme">
			<span class="mui-icon"><img src="../../images/2.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label">操盘记录</span>
		</a>
		<a class="navon" id="account" href="javascript:void(0);">
			<span class="mui-icon"><img src="../../images/3.0.png" style="width: 20px;height:20px;"></span>
			<span class="mui-tab-label" >账户</span>
		</a>
	</nav>
	<div class="mui-content">
		<div class="mui-content-padded ac_money">
			<h2 id="title_name"></h2>
			<h3 id="title_balance"></h3>
			<p>账户余额</p>
		</div>			
		<ul id="list" class="mui-table-view mui-table-view-chevron ac_list">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="charge"><img src="../../images/ac_01.png"><i>我要充值</i></a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="withdraw"><img src="../../images/ac_02.png"><i>我要提现</i></a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="funddetail"><img src="../../images/ac_03.png"><i>资金明细</i></a>
			</li>
		</ul>
		<ul id="list" class="mui-table-view mui-table-view-chevron ac_list">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="user_verified"><img src="../../images/ac_04.png"><i>实名认证</i><b><span id="Certification">未认证</span><b></a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="telPhone"><img src="../../images/ac_05.png"><i>账户绑定</i><b>修改</b></a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="weixin"><img src="../../images/weixinIcon.png"><i>微信绑定</i><b>已关注</b></a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="updatepw"><img src="../../images/ac_06.png"><i>登录密码</i><b>修改</b></a>
			</li>
		</ul>
		<ul id="list" class="mui-table-view mui-table-view-chevron ac_list">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)" id="coupon"><img src="../../images/ac_04.png"><i>优惠券</i></a>
			</li>
			<!--<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="javascript:void(0)"><img src="../../images/ac_05.png"><i>邀请好友</i><b>有奖励</b></a>
			</li>-->
		</ul>
		<ul class="mui-table-view ac_listbtn">
			<li class="mui-table-view-cell" style="text-align: center;">
				<a  href="#quitaccc">退出账户</a>
			</li>
		</ul>
		<div id="quitaccc" class="mui-popover mui-popover-action mui-popover-bottom">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#" style="color: red;" id="confirm_quit">确认退出</a>
				</li>
				
			</ul>  
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#">取消</a>
				</li>
			</ul>
		</div>
		
	</div>	
	<div id="weixinCodeImage">
		<div id="box">
			<p>微信绑定<img src="../../images/close1.png" id="close"></p>
			<div id="weixinContent">  
				<img src="" id="weixinCodeImg">
				<span>点击二维码，截图到本地，打开微信扫一扫，识别二维码，进行关注！</span>
			</div>
		</div>
	</div>
	<script>
		mui.plusReady(function(){
			 $("#weixinCodeImage").css({
			  	"height":window.innerHeight+"px",
			  	"position":"fixed",
			  	"top":"0px",
			  	"z-index":"999",
			  	"padding-top":"25%"
			  });
			  $("#box").css({
			  	"margin":"auto",
			  });
		})
	</script>
</body>
</html>