<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/common.css" rel="stylesheet" />
		<link href="../../css/own.css" rel="stylesheet" />
		<link href="../../css/mui.picker.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/search.css" />
		<link rel="stylesheet" type="text/css" href="../../lib/layui/css/layui.css" />
		<title>搜索页面</title>
		<style>
			#chartContainerContent1 {
				margin-top: 100px;
			}
			
			.caoz {
				padding-left: 15px;
				color: #fcc900;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<!--<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>-->
			<h1 class="mui-title">
	    			<input type="text" id="search" />
		    </h1>
			<a id="searchButton" class="mui-action-back">取消</a>
		</header>
		<div class="mui-content">
			<div id="searchResultContainer" style="padding-top: 10px;">
				<ul class="mui-table-view " id="newsList">
					<!-- 参见 tplNews 模板 -->
				</ul>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../js/mui.min.js"></script>
	<script type="text/javascript" src="../../js/jquery-1.11.3.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../js/mui.picker.min.js"></script>
	<script type="text/javascript" src="../../js/mui.pullToRefresh.js"></script>
	<script type="text/javascript" src="../../js/mui.pullToRefresh.material.js"></script>
	<script type="text/javascript" src="../../lib/layui/layui.js"></script>

	<script id="tplNews" type="text/html">
		{{# layui.each(d, function(index, item){ if(item.IsUsed!=0){ }}
		<li class="">
			<div class="content-left">{{vs.dateUtil.getFormatDataByLong(item.liveCreatetime / 1000, "MM-dd hh:mm")}}</div>
			<div class="content-circular"></div>
			<div class="content-right">
				<p>{{item.liveContent}}</p>
				<div class='xians' style='background: #fff;z-index: 5; width: 100%; position: absolute; top: 103px;'><span class='caoz'>展开</div>
			</div>
		</li>
		{{#			}	}); }} {{# if(d.length === 0){ }} 无数据 {{# } }}
	</script>
	
	<script type="text/javascript">
		var layer, laytpl;
		//一般直接写在一个js文件中
		layui.use(['layer', 'laytpl'], function() {
			layer = layui.layer,
			laytpl = layui.laytpl;
		});
		
		$.ajax({
			url: "http://www.vs.com/crawler/getCrawlerByChannelLiveContent",
			type: "get",
			dataType: "json",
			data: {
				pageIndex: 0,
				size: 30,
				channelset: 1
			},
			success: function(res) {
				if(res.success == true) {
					vs.tplFillData("newsList", "tplNews", res.data.data, vs.constants.FillType.after);
					expandAbleNews();
				}
			},
			error: function(res) {
				error(res);
				var ul = $('#chartContainerContent1 .mui-table-view');
				var ts = $('#chartContainerContent1 .mui-pull-bottom-tips');
				ts.css("display", "none");
				var li;
				li = document.createElement('li');
				li.innerHTML = '<div id="noSearchResultContainer" >' +
					'暂无活动喔，你可关注维胜公众号留意近期活动~</div>';
				ul.append(li);
			}
		});
		
		function expandAbleNews() {
			for(var j= 0;j<$("#searchResultContainer ul li .content-right").length; j++){
				if($("#searchResultContainer ul li .content-right").eq(j).height() > 85){
					$("#searchResultContainer ul li .content-right").eq(j).css("height","120px");
				}else{
					$("#searchResultContainer ul li .content-right").eq(j).find(".caoz").css("display","none");
				}
			}
			$("#searchResultContainer .caoz").on("tap",function() {
				var _this = $(this);
				if(_this.html()  == "展开") {
					_this.parent().removeAttr("style");
					_this.parent().parent().css("height","inherit");
					_this.html("收起");
				}else if(_this.html()  == "收起") {
					_this.parent().css({
						"background": "#ffffff",
						"z-index": "999",
						"width": "100%",
						"position": "absolute",
						"top": "103px",
						"height": "21px"
					});
					_this.parent().parent().css("height","120px");
					_this.html("展开");
				}
			});
		}
	</script>
</html>