<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>提现密码</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/common.css" rel="stylesheet"/>
		<link href="../../css/account.css" rel="stylesheet" />
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">提现密码</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view password-withdramals">
				<li class="mui-table-view-cell">
					<label>手机号码</label>
					<input type="number" placeholder="请输入手机号码" id="mobile" />
					<button id="code">获取验证码</button>
				</li>
				<li class="mui-table-view-cell">
					<label>验证码</label>
					<input type="number" placeholder="输入验证码"  id="code1"/>
				</li>
			</ul>
			<ul class="mui-table-view password-withdramals margin-top-5">
				<li class="mui-table-view-cell">
					<label>提现密码</label>
					<input type="password" placeholder="6-16位数字和字母组成" onkeyup="value=value.replace(/[^\w\.\/]/ig,'')" id="password"/>
				</li>
				<li class="mui-table-view-cell">
					<label>确认密码</label>
					<input type="password" placeholder="再次输入6位数字密码"onkeyup="value=value.replace(/[^\w\.\/]/ig,'')" id="password_confirm" />
				</li>
			</ul>
			<div class="bottom-button-contanier">
				<button id="confirmPasswordButton">验 证</button>
				<p>如遇到问题，请拨打<em id="telBtn"> 400-852-8008</em></p>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../js/mui.min.js"></script>
	<script type="text/javascript" src="../../js/jquery-1.11.3.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script>
		vs.callService();
		if(!mui.isnull(vs.constants.user_mobile)){
			document.getElementById("mobile").value=mui.cacheUser.get(vs.constants.user_mobile);
		}
		document.getElementById("code").addEventListener("tap",function(){
			getCode();
		})
		  //获取短信验证码
		  function getCode(){
		  	var mobile=document.getElementById("mobile").value;
		 	if(!vs.validate_mobile(mobile)||mui.isnull(mobile)){
    			mui.toast("手机号码不正确");
    			return;
    		}
		 	//发送验证码
		 	mui.app_request("user/security/send_sms",{
		 		"mobile":mobile,
				"type":2
		 	},function(result){
		 		var o=document.getElementById("code");
	  			vs.smsTime(o); 
		 		mui.toast("发送成功！");	
		 		return;
		 	},function(result){
		 		if(result.code==2){
		 			mui.toast("短信验证码发送失败！");	
		 			return;
		 		}else if(result.code==3){
		 			mui.toast("手机号码已经存在！");	
		 			return;
		 		}else if(result.code==4){
		 			mui.toast("手机号码不存在！");	
		 			return;
		 		}else if(result.code==5){
		 			mui.toast("操作过于频繁，请稍候再试！");	
		 			return;
		 		}else{
		 			mui.toast("系统繁忙，请稍候再试！");	
		 			return;
		 		}
		 	})
		 	
		  };
		  document.getElementById("confirmPasswordButton").addEventListener("tap",function(){
		  	drawpwSet()
		  })
		  //设置提现密码
		  function drawpwSet(){
		  	var code=document.getElementById("code1").value;
		  	var password=document.getElementById("password_confirm").value;
		  	var password2=document.getElementById("password").value;
		  	console.log(code);
		  	if(mui.isnull(code)){
		  		mui.toast("验证码不能为空");
		  		return;
		  	}
		  	if(!vs.validate_password(password)){
		  		mui.toast("密码必须由6-16位数字和字母组成");
		  		return;
		  	}
		  	if(mui.isnull(password2)){
		  		mui.toast("确认密码不能为空！");
		  		return;
		  	}
		  	if(password!=password2){
		  		mui.toast("两次密码输入不一致");
		  		return;
		  	}
		  	mui.app_request("user/security/set_withdraw_pwd",{
		  		 "code":code,
    			"password":password
		  	},function(result){
		  		mui.toast("设置成功！");
		  		var win=mui.get_window_data("acoount");
		  		if(win.backpageID) {
					mui.app_back(win.backpageID, true,win.url);
					 //放回businessPageId页面，并且刷新该页面信息
					return;
				}
		  		return;
		  	},function(result){
		  		console.log(JSON.stringify(result));
		  		if(result.code==2){
		  			mui.toast("设置失败");
		  			return;
		  		}else if(result.code==3){
		  			mui.toast("用户信息不存在");
		  			return;
		  		}else if(result.code==4){
		  			mui.toast("提款密码不能与登录密码相同");
		  			return;
		  		}else if(result.code==5){
		  			mui.toast("密码格式有误");
		  			return;
		  		}else if(result.code==6){
		  			mui.toast("验证码错误或失效");
		  			return;
		  		}
		  	})
		  	
		  	
		  };
	</script>
</html>
