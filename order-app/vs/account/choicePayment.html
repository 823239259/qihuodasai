<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>选择支付方式</title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/common.css" rel="stylesheet" />
		<link href="../../css/account.css" rel="stylesheet" />
		<link href="../../css/own.css" rel="stylesheet" />
	</head>

	<body class="choice-payment">
		<header class="mui-bar mui-bar-nav own-topbg">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" id="back"></a>
			<h1 class="mui-title">选择支付方式</h1>
			<a href="javascript:void(0)" class="top-tel" id="telBtn">客服热线</a>
		</header>
		<div class="mui-content">
			<form class="mui-input-group charge-list">
				<!--<div class="mui-input-row mui-radio">
					<label><img src="../../images/recharge/Transfer.png"><i>支付宝</i></label>
					<input name="choiceBank" type="radio"value="5">
				</div>-->
				<div class="mui-input-row mui-radio">
					<label><img src="../../img/recharge/zhifubao.png"><i>支付宝</i></label>
					<input name="choiceBank" type="radio" value="10" checked="checked">
				</div>
				<!--<div class="mui-input-row mui-radio">
					<label><img src="../../img/recharge/Quickpayment.png"><i>快捷支付</i></label>
					<input name="choiceBank" type="radio"value="6" >
				</div>-->
				<!--<div class="mui-input-row mui-radio">
					<label><img src="../../img/recharge/Transfer.png"><i>微信扫码支付</i></label>
					<input name="choiceBank" type="radio"value="8" checked="checked">
				</div>-->
				<div class="mui-input-row mui-radio">
					<label><img src="../../img/recharge/bankP.png"><i>网银支付</i></label>
					<input name="choiceBank" type="radio" value="2">
				</div>
				<!--<div class="mui-input-row mui-radio" id"weixinPay">
					<label><img src="../../img/recharge/wei.png"><i>微信转账</i></label>
					<input name="choiceBank" type="radio" value="3">
				</div>-->
				<div class="mui-input-row mui-radio">
					<label><img src="../../img/recharge/Transfer.png"><i>银行转账</i></label>
					<input name="choiceBank" type="radio" value="4">
				</div>
			</form>
			<div id="buttomDiv">
				<span>支付：<i class="yellowFont moneyIcont" >¥</i><i id="paymentMoney"></i></span>
				<button type="button" id="rechargeBtn" class="mui-btn  lg-btnlogin">立即付款</button>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../js/mui.min.js"></script>
	<script src="../../js/jquery-1.11.3.js"></script>
	<script type="text/javascript" src="../../js/pingpp.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script>
		mui.init();
		vs.callService();
		var wv;
		var paymentMoney
		if(vs.browser.versions.Html5Plus) {
			mui.plusReady(function() {
				wv = mui.get_window_data("recharge");
				paymentMoney = document.getElementById("paymentMoney");
				paymentMoney.innerText = wv.money.toFixed(2);
			})
		}

		document.getElementById("rechargeBtn").addEventListener("tap", function() {
			immediatePayment(wv);
		});

		function immediatePayment(wv) {
			var val = $('.charge-list input[name="choiceBank"]:checked ').val();
			if(val == 3) {
				mui.open_window_data("weixinPay.html", "weixinPay", { money: wv.money,backId: wv.backId});
			} else if(val == 4) {
				mui.open_window_data("bankPay.html", "bankPay", { money: wv.money,backId: wv.backId});
			} else if(val == 2) {
				bank(wv);
			} else if(val == 1) {
				jdWayPay(wv);
			} else if(val == 5) {
				alipay(wv);
			} else if(val == 6) {
				quickPay(wv);
			} else if(val == 8) {
				qrcodePay(wv);
			} else if(val == 10) {
				mui.open_window_data("bindzhifubao.html", "bindzhifubao", { money: wv.money,backId: wv.backId});
			}
		};

		function quickPay(wv) {
			plus.nativeUI.showWaiting("正在跳转...");
			var money = wv.money;
			var w = plus.webview.create("alipay.html", "aliay", { top: "65px" }, { data: money, type: 6 });
			w.show();
		}
		/**
		 * 微信扫码支付
		 * @param {Object} wv
		 */
		function qrcodePay(wv) {
			plus.nativeUI.showWaiting("正在跳转...");
			var money = wv.money;
			var w = plus.webview.create("alipay.html", "aliay", { top: "65px" }, { data: money, type: 8 });
			w.show();
		}
		/**
		 * 支付宝支付
		 * @param {Object} wv
		 */
		function alipay(wv) {
			plus.nativeUI.showWaiting("正在跳转...");
			var money = wv.money;
			var w = plus.webview.create("alipay.html", "aliay", { top: "65px" }, { data: money, type: 5 });
			w.show();
		}
		/**
		 * 
		 * @param {Object} money 支付金额
		 */
		function jdWayPay(wv) {
			var money = wv.money;
			//充值"操作"
			mui.app_request('/user/pay/jdpay_wap', {
				"money": money,
				"payWay": 10
			}, function(result) {
				var charge = JSON.parse(result.data);
				pingpp.createPayment(charge, function(result, err) {
					if(result == "success") {
						// 只有微信公众账号 wx_pub 支付成功的结果会在这里返回，其他的支付结果都会跳转到 extra 中对应的 URL。
					} else if(result == "fail") {
						// charge 不正确或者微信公众账号支付失败时会在此处返回
					} else if(result == "cancel") {
						// 微信公众账号支付取消支付
					}
				});
				return;
			}, function(result) {
				mui.toast(result.message);
			});
		}
		//网银充值“立即充值”操作
		function bank(wv) {
			var money = wv.money;
			//充值"操作"
			mui.app_request('/user/pay/gopay', {
				"goPaymoney": money,
				"gopayWay": 7
			}, function(result) {
				var data = result.data;
				plus.nativeUI.showWaiting("正在跳转...");
				setTimeout(function() {
					plus.nativeUI.closeWaiting();
				}, 2000);
				var w = plus.webview.create("gopay.html", "gopay", { top: "65px" }, { data: result });
				w.show();
				return;
			}, function(result) {
				if(result.code == 2) {
					mui.toast("充值金额不能为空！");
					return;
				} else if(result.code == 3) {
					mui.toast("充值金额必须大于或等于1、小于或等于5000000！");
					return;
				} else if(result.code == 4) {
					mui.toast("在线网银每天限额10万元，超额部分请选择其他方式充值！");
					return;
				} else {
					mui.toast("系统繁忙，请稍后再试！");
					return;
				}
			});
		}
		//			});
	</script>

</html>