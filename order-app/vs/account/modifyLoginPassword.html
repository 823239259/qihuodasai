<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>修改登录密码</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/common.css" rel="stylesheet"/>
		<link href="../../css/account.css"  rel="stylesheet"/>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title">修改登录密码</h1>
		</header>
		<div class="mui-content">
			<div class="passwore-row-contanier">
				<div class="passwore-row">
					<label>旧密码</label>
					<input type="password"  placeholder="请输入旧密码" id="oldPassword" onkeyup="value=value.replace(/[^\w\.\/]/ig,'')"/>
				</div>
			</div>
			<div class="passwore-row-contanier">
				<div class="passwore-row new-passsword-row">
					<label>新密码</label>
					<input type="password" placeholder="请输入新密码" id="newPassword" onkeyup="value=value.replace(/[^\w\.\/]/ig,'')"/>
				</div>
				<div class="passwore-row">
					<label>确认密码</label>
					<input type="password" placeholder="请再次输入新密码" id="confirmPassword" onkeyup="value=value.replace(/[^\w\.\/]/ig,'')"/>
				</div>
			</div>
			<div class="bottom-button-contanier">
				<button id="confirmPasswordButton">确 认</button>
				<p>如遇到问题，请拨打<em id="telBtn"> 400-852-8008</em></p>
			</div>
		</div>
		<script type="text/javascript" src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script type="text/javascript" src="../../js/jquery-1.11.3.js"></script>
		<script>
			mui.init();
			vs.callService();
			document.getElementById("confirmPasswordButton").addEventListener("tap",function(){
				var oldPassword = document.getElementById("oldPassword").value;
				var newPassword = document.getElementById("newPassword").value;
				var confirmPassword = document.getElementById("confirmPassword").value;
				console.log(confirmPassword+"     "+newPassword)
				if(oldPassword == "" || oldPassword == null){
					mui.toast("请输入旧密码");
					return
				}
				if(newPassword == "" || newPassword == null){
					mui.toast("请输入新密码");
					return
				}
				if(confirmPassword == "" || confirmPassword == null){
					mui.toast("请再次输入新密码");
					return
				}
				if(confirmPassword != newPassword){
					mui.toast("两次输入不一致");
					return
				}
				if(oldPassword == newPassword){
					mui.toast("新旧密码不能相同");
					return
				}
				modifLoginPassword();
			});
			function modifLoginPassword(newPassword){
				var phone=mui.cacheUser.get(vs.constants.user_mobile);
				console.log(phone);
				mui.app_request('/reset_password',{ 
      			 'mobile':phone,
			    'password':newPassword
      		},function(result){
      			console.log(JSON.stringify(result));
      				mui.toast("密码重置成功，请重新登录！");
      				mui.cacheUser.clear();
			  		mui.openWindow("../login/login.html",'login');
      				return;
      			
      		},function(result){
      			if(result.code==2){
      				mui.toast("重置失败！");
      				return;
      			}else if(result.code==6){
      				mui.toast("密码格式有误！");
      				return;
      			}else if(result.code==5){
      				mui.toast("验证码错误或为空！");
      				return;
      			}else if(result.code==4){
      				mui.toast("验证码失效！");
      				return;
      			}else if(result.code==3){
      				mui.toast("用户信息不存在！");
      				return;
      			}else{
      				mui.toast("系统繁忙，请稍后再试！");
      				return;
      			}
      			
      		});
			}
		</script>
	</body>
</html>
