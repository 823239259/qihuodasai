<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Test remote Login using JS</title>
<script type="text/javascript">
	var error, casLoginURL, loginTicket, flowExecutionKey;

	function prepareLoginForm() {
		$('myLoginForm').action = casLoginURL;
		$("lt").value = loginTicket;
		$("execution").value = flowExecutionKey;
	}

	function checkForLoginTicket() {
		var loginTicketProvided = false;
		var query = '';
		casLoginURL = 'http://dev.sso.tzdr.com:8088/cas/login';
		thisPageURL = 'http://dev.sso.tzdr.com:8088/cas/test-login.html';
		casLoginURL += '?login-at=' + encodeURIComponent(thisPageURL);

		query = window.location.search;
		query = query.substr(1);

		var param = new Array();
		//var value	= new Array();
		var temp = new Array();
		param = query.split('&');

		i = 0;
		// 开始获取当前 url 的参数，获到 lt 和 error_message。
		while (param[i]) {
			temp = param[i].split('=');
			if (temp[0] == 'lt') {
				loginTicket = temp[1];
				loginTicketProvided = true;
			}
			if (temp[0] == 'execution') {
				flowExecutionKey = temp[1];
			}
			if (temp[0] == 'error_message') {
				error = temp[1];
			}
			i++;
		}
		// 判断是否已经获取到 lt 参数，如果未获取到则跳转至 cas/login 页，并且带上请求参数  get-lt=true。 第一次进该页面时会进行一次跳转
		if (!loginTicketProvided) {
			location.href = casLoginURL + '&get-lt=true';
		}
	}

	var $ = function(id) {
		return document.getElementById(id);
	}

	checkForLoginTicket();
	onload = prepareLoginForm;
</script>
</head>
<body>
	<h2>Test remote Login using JS</h2>
	<form id="myLoginForm" action="" method="post">
		<input type="hidden" name="_eventId" value="submit" />
		<table>
			<tr>
				<td id="txt_error" colspan="2">
					<script type="text/javascript" language="javascript">
					<!--
						if (error) {
	
							error = decodeURIComponent(error);
	
							document.write(error);
						}
					//-->
					</script>
				</td>
			</tr>
			<tr>
				<td>Username:</td>
				<td><input type="text" value="" name="username"></td>
			</tr>
			<tr>
				<td>Password:</td>
				<td><input type="text" value="" name="password"></td>
			</tr>
			<tr>
				<td>Login Ticket:</td>
				<td><input type="text" name="lt" id="lt" value=""></td>
			</tr>
			<tr>
				<td>execution:</td>
				<td><input type="text" name="execution" id="execution" value=""></td>
			</tr>
			<tr>
				<td>Service:</td>
				<td><input type="text" name="service"
					value="http://www.baidu.com"></td>
			</tr>
			<tr>
				<td align="right" colspan="2"><input type="submit" /></td>
			</tr>
		</table>
	</form>
</body>
</html>